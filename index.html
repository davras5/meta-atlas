<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta-Atlas | Metadata Catalog</title>
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* ========================================
           CSS Variables & Design Tokens
           Based on DESIGNGUIDE.md specifications
           ======================================== */
        :root {
            /* ===== Color System - Slate Scale ===== */

            /* Dark Mode (Primary) - Slate Scale */
            --color-bg-base: #0F172A;
            --color-bg-surface: #1E293B;
            --color-bg-elevated: #334155;
            --color-bg-hover: #475569;

            --color-text-primary: #F1F5F9;
            --color-text-secondary: #94A3B8;
            --color-text-muted: #64748B;

            --color-border-default: #334155;
            --color-border-subtle: #1E293B;

            /* Layer Colors - Dark Mode */
            --color-conceptual: #60A5FA;
            --color-conceptual-bg: #1E3A5F;
            --color-conceptual-border: #3B82F6;

            --color-logical: #34D399;
            --color-logical-bg: #064E3B;
            --color-logical-border: #10B981;

            --color-physical: #FBBF24;
            --color-physical-bg: #451A03;
            --color-physical-border: #F59E0B;

            /* Status Colors */
            --color-status-active: #10B981;
            --color-status-draft: #F59E0B;
            --color-status-deprecated: #64748B;
            --color-status-planned: #8B5CF6;

            /* Semantic Colors */
            --color-error: #EF4444;
            --color-warning: #F59E0B;
            --color-success: #10B981;
            --color-info: #3B82F6;

            /* Compliance Badge Colors */
            --color-public: #10B981;
            --color-internal: #3B82F6;
            --color-confidential: #F59E0B;
            --color-secret: #EF4444;
            --color-personal-data: #8B5CF6;

            /* Swiss Accent (critical actions only) */
            --color-swiss-red: #DC2626;

            /* ===== Typography ===== */
            --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SF Mono", SFMono-Regular, Consolas, "Liberation Mono", Menlo, Monaco, monospace;

            /* Type Scale */
            --text-display: 2rem;      /* 32px */
            --text-h1: 1.5rem;         /* 24px */
            --text-h2: 1.25rem;        /* 20px */
            --text-h3: 1rem;           /* 16px */
            --text-body: 1rem;         /* 16px */
            --text-small: 0.875rem;    /* 14px */
            --text-caption: 0.75rem;   /* 12px */

            /* Line Heights */
            --leading-display: 1.2;
            --leading-h1: 1.3;
            --leading-h2: 1.35;
            --leading-h3: 1.4;
            --leading-body: 1.6;
            --leading-small: 1.5;
            --leading-caption: 1.4;

            /* Font Weights */
            --font-normal: 400;
            --font-medium: 500;
            --font-semibold: 600;

            /* ===== Spacing Scale (4px base) ===== */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            --space-10: 40px;
            --space-12: 48px;

            /* ===== Layout Dimensions ===== */
            --sidebar-width: 280px;
            --sidebar-min-width: 200px;
            --sidebar-max-width: 400px;
            --sidebar-collapsed-width: 56px;
            --header-height: 56px;
            --sub-header-height: 48px;
            --content-max-width: 1200px;
            --prose-max-width: 720px;
            --layout-max-width: 1600px;

            /* ===== Border Radius ===== */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --radius-xl: 12px;
            --radius-full: 9999px;

            /* ===== Shadows - Dark Mode ===== */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);

            /* ===== Animation ===== */
            --duration-fast: 100ms;
            --duration-normal: 200ms;
            --duration-slow: 300ms;
            --ease-out: cubic-bezier(0, 0, 0.2, 1);
            --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);

            /* ===== Breakpoints ===== */
            --breakpoint-sm: 640px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 1024px;
            --breakpoint-xl: 1440px;
        }

        /* ===== Light Theme ===== */
        [data-theme="light"] {
            --color-bg-base: #FFFFFF;
            --color-bg-surface: #F8FAFC;
            --color-bg-elevated: #FFFFFF;
            --color-bg-hover: #F1F5F9;

            --color-text-primary: #0F172A;
            --color-text-secondary: #475569;
            --color-text-muted: #64748B;

            --color-border-default: #CBD5E1;
            --color-border-subtle: #E2E8F0;

            /* Layer Colors - Light Mode */
            --color-conceptual: #2563EB;
            --color-conceptual-bg: #DBEAFE;
            --color-conceptual-border: #2563EB;

            --color-logical: #059669;
            --color-logical-bg: #D1FAE5;
            --color-logical-border: #059669;

            --color-physical: #D97706;
            --color-physical-bg: #FEF3C7;
            --color-physical-border: #D97706;

            /* Shadows - Light Mode */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        /* ===== Reduced Motion ===== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ========================================
           Base Styles
           ======================================== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-sans);
            font-size: var(--text-body);
            line-height: var(--leading-body);
            background-color: var(--color-bg-base);
            color: var(--color-text-primary);
        }

        /* ===== Focus States ===== */
        :focus {
            outline: none;
        }

        :focus-visible {
            outline: 2px solid var(--color-conceptual);
            outline-offset: 2px;
        }

        /* ===== Skip Link ===== */
        .skip-link {
            position: absolute;
            top: -100%;
            left: var(--space-4);
            padding: var(--space-2) var(--space-4);
            background: var(--color-bg-elevated);
            color: var(--color-text-primary);
            border-radius: var(--radius-md);
            z-index: 1000;
            transition: top var(--duration-fast) var(--ease-out);
        }

        .skip-link:focus {
            top: var(--space-4);
        }

        /* ========================================
           Layout
           ======================================== */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-layout {
            display: flex;
            flex: 1;
            max-width: var(--layout-max-width);
            margin: 0 auto;
            width: 100%;
        }

        /* ===== Sub Header ===== */
        .sub-header {
            height: var(--sub-header-height);
            background: var(--color-bg-surface);
            border-bottom: 1px solid var(--color-border-default);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sub-header-inner {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: var(--layout-max-width);
            padding: 0 var(--space-5);
            position: relative;
        }

        .sub-header-left {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .sub-header-right {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
        }

        .version-selector {
            height: 32px;
            padding: 0 var(--space-4);
            padding-right: var(--space-8);
            background: var(--color-bg-base);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            color: var(--color-text-primary);
            font-family: var(--font-sans);
            font-size: var(--text-small);
            font-weight: var(--font-medium);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 8px center;
        }

        .version-selector:hover {
            border-color: var(--color-text-muted);
        }

        .version-selector:focus {
            outline: none;
            border-color: var(--color-conceptual);
            box-shadow: 0 0 0 2px var(--color-conceptual-bg);
        }

        .sub-header .view-tabs {
            display: flex;
            align-items: center;
            gap: var(--space-6);
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }

        .sub-header .view-tab {
            padding: var(--space-2) 0;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-family: var(--font-sans);
            font-size: var(--text-small);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
        }

        .sub-header .view-tab:hover {
            color: var(--color-text-primary);
        }

        .sub-header .view-tab.active {
            color: var(--color-text-primary);
            font-weight: var(--font-semibold);
            border-bottom-color: var(--color-conceptual);
        }

        .group-by-dropdown {
            position: relative;
        }

        .group-by-trigger {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            height: 28px;
            padding: 0 var(--space-2);
            padding-right: var(--space-1);
            background: transparent;
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-sm);
            color: var(--color-text-secondary);
            font-family: var(--font-sans);
            font-size: var(--text-xs);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
        }

        .group-by-trigger:hover {
            background: var(--color-bg-hover);
            color: var(--color-text-primary);
        }

        .group-by-trigger-icon {
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .group-by-trigger-icon svg {
            width: 14px;
            height: 14px;
        }

        .group-by-trigger-text {
            flex: 1;
        }

        .group-by-trigger-arrow {
            width: 12px;
            height: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform var(--duration-fast) var(--ease-out);
        }

        .group-by-trigger-arrow svg {
            width: 12px;
            height: 12px;
        }

        .group-by-dropdown.open .group-by-trigger-arrow {
            transform: rotate(180deg);
        }

        .group-by-menu {
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 160px;
            margin-top: var(--space-1);
            background: var(--color-bg-elevated);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            display: none;
            padding: var(--space-1);
        }

        .group-by-dropdown.open .group-by-menu {
            display: block;
        }

        .group-by-option {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            width: 100%;
            padding: var(--space-2) var(--space-3);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            color: var(--color-text-secondary);
            font-family: var(--font-sans);
            font-size: var(--text-xs);
            cursor: pointer;
            text-align: left;
            transition: all var(--duration-fast) var(--ease-out);
        }

        .group-by-option:hover {
            background: var(--color-bg-hover);
            color: var(--color-text-primary);
        }

        .group-by-option.selected {
            background: var(--color-conceptual-bg);
            color: var(--color-conceptual);
        }

        .group-by-option-icon {
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .group-by-option-icon svg {
            width: 14px;
            height: 14px;
        }

        /* ===== Loading State ===== */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            flex-direction: column;
            gap: var(--space-4);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--color-border-default);
            border-top-color: var(--color-logical);
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========================================
           Header
           ======================================== */
        .header {
            height: var(--header-height);
            background-color: var(--color-bg-surface);
            border-bottom: 1px solid var(--color-border-default);
            display: flex;
            align-items: center;
            padding: 0 var(--space-5);
            gap: var(--space-6);
            position: relative;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--text-h3);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            letter-spacing: -0.02em;
            text-decoration: none;
            padding: var(--space-2);
            margin: calc(var(--space-2) * -1);
            border-radius: var(--radius-md);
            transition: background-color var(--duration-fast) var(--ease-out);
        }

        .logo:hover {
            background-color: var(--color-bg-hover);
        }

        .logo-icon {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-conceptual);
        }

        .logo-icon svg {
            width: 22px;
            height: 22px;
        }

        /* ===== Layer Tabs ===== */
        .layer-tabs {
            display: flex;
            gap: 2px;
            background: var(--color-bg-base);
            padding: 3px;
            border-radius: var(--radius-md);
        }

        .layer-tab {
            padding: var(--space-2) var(--space-4);
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-family: var(--font-sans);
            font-size: var(--text-small);
            font-weight: var(--font-medium);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .layer-tab:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-hover);
        }

        .layer-tab.active {
            color: white;
            font-weight: var(--font-semibold);
        }

        .layer-tab[data-layer="conceptual"].active {
            background: var(--color-conceptual);
        }

        .layer-tab[data-layer="logical"].active {
            background: var(--color-logical);
            color: var(--color-bg-base);
        }

        .layer-tab[data-layer="physical"].active {
            background: var(--color-physical);
            color: var(--color-bg-base);
        }

        /* ===== Expanding Search ===== */
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-toggle {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .search-toggle:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-hover);
        }

        .search-toggle svg {
            width: 18px;
            height: 18px;
        }

        .search-container.expanded .search-toggle {
            display: none;
        }

        .search-wrapper {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            overflow: hidden;
            transition: width var(--duration-normal) var(--ease-out);
        }

        .search-container.expanded .search-wrapper {
            width: 280px;
        }

        .search-input {
            width: 100%;
            height: 36px;
            padding: 0 var(--space-4);
            background: var(--color-bg-base);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            color: var(--color-text-primary);
            font-family: var(--font-sans);
            font-size: var(--text-small);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .search-input:hover {
            border-color: var(--color-text-muted);
        }

        .search-input:focus {
            border-color: var(--color-conceptual);
            box-shadow: 0 0 0 2px var(--color-conceptual-bg);
            outline: none;
        }

        .search-input::placeholder {
            color: var(--color-text-muted);
        }

        /* ===== Header Right ===== */
        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-left: auto;
        }

        .lang-selector {
            height: 32px;
            padding: 0 var(--space-3);
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            color: var(--color-text-secondary);
            font-family: var(--font-sans);
            font-size: var(--text-caption);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
        }

        .lang-selector:hover {
            background: var(--color-bg-hover);
            color: var(--color-text-primary);
        }

        .lang-selector:focus {
            border-color: var(--color-conceptual);
            outline: none;
        }

        .icon-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
        }

        .icon-btn:hover {
            background: var(--color-bg-hover);
            color: var(--color-text-primary);
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        .icon-btn svg {
            width: 18px;
            height: 18px;
        }

        /* ========================================
           Sidebar
           ======================================== */
        .sidebar {
            position: relative;
            width: var(--sidebar-width);
            min-width: var(--sidebar-min-width);
            max-width: var(--sidebar-max-width);
            background: var(--color-bg-surface);
            border-left: 1px solid var(--color-border-default);
            border-right: 1px solid var(--color-border-default);
            display: flex;
            flex-direction: column;
            overflow: visible;
            transition: width var(--duration-slow) var(--ease-in-out);
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
            min-width: var(--sidebar-collapsed-width);
        }

        .sidebar-header {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border-default);
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 44px;
            box-sizing: border-box;
            background: var(--color-bg-surface);
        }

        .sidebar-title {
            font-size: 11px;
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--color-text-secondary);
        }

        .sidebar.collapsed .sidebar-title {
            display: none;
        }

        .sidebar-toggle {
            position: absolute;
            right: -13px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 26px;
            height: 26px;
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            color: var(--color-text-muted);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast) var(--ease-out);
            z-index: 50;
        }

        .sidebar-toggle:hover {
            background: var(--color-bg-hover);
            color: var(--color-text-primary);
        }

        .sidebar-toggle svg {
            width: 16px;
            height: 16px;
            transition: transform var(--duration-fast) var(--ease-out);
        }

        .sidebar.collapsed .sidebar-toggle svg {
            transform: rotate(180deg);
        }

        .tree-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-3);
        }

        /* ===== Tree Navigation ===== */
        .layer-section {
            margin-bottom: var(--space-4);
        }

        .layer-section-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-small);
            font-weight: var(--font-semibold);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--duration-fast) var(--ease-out);
            user-select: none;
            background: var(--color-bg-hover);
        }

        .layer-section-header.conceptual {
            color: var(--color-conceptual);
        }

        .layer-section-header.logical {
            color: var(--color-logical);
        }

        .layer-section-header.physical {
            color: var(--color-physical);
        }

        .layer-section-header:hover {
            background: var(--color-bg-active);
        }

        .layer-section-header .layer-toggle {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-muted);
            transition: transform var(--duration-fast) var(--ease-out);
            flex-shrink: 0;
        }

        .layer-section-header .layer-toggle svg {
            width: 12px;
            height: 12px;
        }

        .layer-section-header.collapsed .layer-toggle {
            transform: rotate(-90deg);
        }

        .layer-section-content {
            padding-left: var(--space-1);
            padding-top: var(--space-1);
        }

        .layer-section-content.collapsed {
            display: none;
        }

        .tree-section {
            margin-bottom: var(--space-4);
        }

        .tree-section-header {
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-caption);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
        }

        .tree-item {
            user-select: none;
        }

        .tree-node {
            display: flex;
            align-items: center;
            padding: 6px var(--space-3);
            border-radius: var(--radius-md);
            cursor: pointer;
            gap: var(--space-2);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .tree-node:hover {
            background: var(--color-bg-hover);
        }

        .tree-node.selected {
            background: var(--color-bg-elevated);
        }

        .tree-node.selected.conceptual {
            background: var(--color-conceptual-bg);
        }

        .tree-node.selected.logical {
            background: var(--color-logical-bg);
        }

        .tree-node.selected.physical {
            background: var(--color-physical-bg);
        }

        .tree-toggle {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-muted);
            flex-shrink: 0;
            transition: transform var(--duration-fast) var(--ease-out);
            border-radius: var(--radius-sm);
        }

        .tree-toggle:hover {
            background: var(--color-bg-base);
        }

        .tree-toggle.expanded {
            transform: rotate(90deg);
        }

        .tree-toggle svg {
            width: 12px;
            height: 12px;
        }

        /* ===== Attribute Tree Items ===== */
        .tree-attribute .tree-node {
            padding-left: var(--space-3);
            opacity: 0.8;
        }

        .tree-attribute .tree-node:hover {
            opacity: 1;
        }

        .attribute-node {
            opacity: 0.85;
        }

        .attribute-node:hover {
            opacity: 1;
        }

        .tree-column .tree-node {
            padding-left: var(--space-3);
            opacity: 0.8;
        }

        .tree-column .tree-node:hover {
            opacity: 1;
        }

        .column-node {
            opacity: 0.85;
            cursor: default;
        }

        .column-node:hover {
            opacity: 1;
            background: transparent;
        }

        .tree-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            color: var(--color-text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tree-icon svg {
            width: 14px;
            height: 14px;
        }

        .tree-node.conceptual .tree-icon { color: var(--color-conceptual); }
        .tree-node.logical .tree-icon { color: var(--color-logical); }
        .tree-node.physical .tree-icon { color: var(--color-physical); }

        .tree-label {
            font-size: var(--text-small);
            color: var(--color-text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .tree-count {
            font-size: 11px;
            color: var(--color-text-muted);
            padding: 1px 6px;
            background: var(--color-bg-base);
            border-radius: var(--radius-full);
            font-weight: var(--font-medium);
        }

        .tree-children {
            margin-left: var(--space-5);
            display: none;
        }

        .tree-children.expanded {
            display: block;
        }

        /* ========================================
           Main Content
           ======================================== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--color-bg-base);
        }

        /* ===== Breadcrumb ===== */
        .breadcrumb {
            padding: 0;
            background: transparent;
            display: flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--text-small);
            box-sizing: border-box;
        }

        .breadcrumb-item {
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 4px var(--space-2);
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .breadcrumb-item:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-hover);
        }

        .breadcrumb-separator {
            color: var(--color-text-muted);
            font-size: var(--text-caption);
            padding: 0 2px;
        }

        .breadcrumb-current {
            color: var(--color-text-primary);
            font-weight: var(--font-medium);
            padding: 4px var(--space-2);
        }

        /* ===== Content Area ===== */
        .content-area {
            flex: 1;
            padding: var(--space-8);
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
            max-width: var(--content-max-width);
        }

        #contentBody {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        /* ===== Entity Header ===== */
        .entity-header {
            margin-bottom: 0;
        }

        .entity-badges {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: 3px var(--space-3);
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .badge-layer {
            color: white;
        }

        .badge-layer.conceptual {
            background: var(--color-conceptual);
        }

        .badge-layer.logical {
            background: var(--color-logical);
            color: var(--color-bg-base);
        }

        .badge-layer.physical {
            background: var(--color-physical);
            color: var(--color-bg-base);
        }

        .badge-outline {
            background: transparent;
            border: 1px solid currentColor;
            color: var(--color-text-secondary);
        }

        .badge-compliance {
            font-weight: var(--font-semibold);
        }

        .badge-compliance.public { color: var(--color-public); border-color: var(--color-public); }
        .badge-compliance.internal { color: var(--color-internal); border-color: var(--color-internal); }
        .badge-compliance.confidential { color: var(--color-confidential); border-color: var(--color-confidential); }
        .badge-compliance.secret { color: var(--color-secret); border-color: var(--color-secret); }
        .badge-compliance.personal-data { color: var(--color-personal-data); border-color: var(--color-personal-data); }

        .entity-title {
            font-size: var(--text-h1);
            font-weight: var(--font-semibold);
            line-height: var(--leading-h1);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-2);
            color: var(--color-text-primary);
        }

        .entity-subtitle {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            line-height: var(--leading-body);
            max-width: var(--prose-max-width);
        }

        .entity-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-4);
            margin-top: var(--space-4);
            padding-top: var(--space-4);
            border-top: 1px solid var(--color-border-subtle);
            font-size: var(--text-small);
            color: var(--color-text-secondary);
        }

        .entity-meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        /* ===== Status Indicators ===== */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
        }

        .status-dot.active { background: var(--color-status-active); }
        .status-dot.draft {
            background: transparent;
            border: 2px solid var(--color-status-draft);
        }
        .status-dot.deprecated { background: var(--color-status-deprecated); opacity: 0.6; }
        .status-dot.planned {
            width: 8px;
            height: 8px;
            background: var(--color-status-planned);
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            border-radius: 0;
        }

        /* ===== View Tabs ===== */
        .view-tabs {
            display: flex;
            gap: var(--space-1);
            margin-bottom: 0;
            border-bottom: 1px solid var(--color-border-default);
            padding-bottom: 0;
        }

        .view-tab {
            padding: var(--space-3) var(--space-4);
            background: none;
            border: none;
            color: var(--color-text-muted);
            font-family: var(--font-sans);
            font-size: var(--text-small);
            font-weight: var(--font-medium);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: all var(--duration-fast) var(--ease-out);
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
        }

        .view-tab:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-hover);
        }

        .view-tab.active {
            color: var(--color-text-primary);
            border-bottom-color: var(--color-text-primary);
            font-weight: var(--font-semibold);
        }

        .view-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        /* ===== Cards/Panels ===== */
        .card {
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: box-shadow var(--duration-normal) var(--ease-out);
        }

        .card:hover {
            box-shadow: var(--shadow-sm);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-5);
            background: transparent;
            cursor: pointer;
            transition: background-color var(--duration-fast) var(--ease-out);
        }

        .card-header:hover {
            background: var(--color-bg-hover);
        }

        .card-title {
            font-size: var(--text-small);
            font-weight: var(--font-semibold);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--color-text-primary);
        }

        .card-toggle {
            color: var(--color-text-muted);
            transition: transform var(--duration-fast) var(--ease-out);
        }

        .card-toggle svg {
            width: 16px;
            height: 16px;
        }

        .card.collapsed .card-toggle {
            transform: rotate(-90deg);
        }

        .card-content {
            padding: var(--space-5);
            border-top: 1px solid var(--color-border-subtle);
        }

        .card.collapsed .card-content {
            display: none;
        }

        /* ===== Metadata Grid ===== */
        .meta-grid {
            display: grid;
            grid-template-columns: 160px 1fr;
            gap: var(--space-3) var(--space-5);
            font-size: var(--text-small);
        }

        .meta-label {
            color: var(--color-text-muted);
            font-weight: var(--font-medium);
        }

        .meta-value {
            color: var(--color-text-primary);
        }

        .meta-value a {
            color: var(--color-conceptual);
            text-decoration: none;
            transition: color var(--duration-fast) var(--ease-out);
        }

        .meta-value a:hover {
            text-decoration: underline;
        }

        /* ===== Tags ===== */
        .tag {
            display: inline-block;
            padding: var(--space-1) var(--space-2);
            background: var(--color-bg-base);
            border-radius: var(--radius-sm);
            font-size: var(--text-caption);
            color: var(--color-text-secondary);
            margin-right: var(--space-1);
            margin-bottom: var(--space-1);
        }

        .tag-mono {
            font-family: var(--font-mono);
            background: var(--color-bg-elevated);
        }

        /* ===== Mapping Cards ===== */
        .mapping-section {
            margin-bottom: var(--space-5);
        }

        .mapping-section:last-child {
            margin-bottom: 0;
        }

        .mapping-section-header {
            font-size: var(--text-caption);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
            margin-bottom: var(--space-3);
        }

        .mapping-card {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4);
            background: var(--color-bg-base);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-2);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
        }

        .mapping-card:hover {
            background: var(--color-bg-hover);
            border-color: var(--color-border-default);
        }

        .mapping-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-semibold);
            font-size: var(--text-small);
            flex-shrink: 0;
        }

        .mapping-icon.conceptual {
            background: var(--color-conceptual-bg);
            color: var(--color-conceptual);
        }

        .mapping-icon.logical {
            background: var(--color-logical-bg);
            color: var(--color-logical);
        }

        .mapping-icon.physical {
            background: var(--color-physical-bg);
            color: var(--color-physical);
        }

        .mapping-info {
            flex: 1;
            min-width: 0;
        }

        .mapping-title {
            font-weight: var(--font-medium);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mapping-subtitle {
            font-size: var(--text-caption);
            color: var(--color-text-secondary);
        }

        .mapping-arrow {
            color: var(--color-text-muted);
            flex-shrink: 0;
        }

        /* ===== Attributes Table ===== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--text-small);
        }

        .data-table th {
            text-align: left;
            padding: var(--space-3) var(--space-4);
            background: var(--color-bg-base);
            color: var(--color-text-muted);
            font-weight: var(--font-medium);
            font-size: var(--text-caption);
            text-transform: uppercase;
            letter-spacing: 0.025em;
            border-bottom: 1px solid var(--color-border-default);
        }

        .data-table td {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border-subtle);
            vertical-align: middle;
        }

        .data-table tbody tr {
            transition: background-color var(--duration-fast) var(--ease-out);
        }

        .data-table tbody tr:hover {
            background: var(--color-bg-hover);
        }

        .data-table tbody tr.clickable-row {
            cursor: pointer;
        }

        .data-table tbody tr.clickable-row:hover {
            background: var(--color-conceptual-bg);
        }

        .data-table code {
            font-family: var(--font-mono);
            font-size: var(--text-caption);
            padding: var(--space-1) var(--space-2);
            background: var(--color-bg-base);
            border-radius: var(--radius-sm);
        }

        .key-badge {
            display: inline-block;
            padding: 2px var(--space-2);
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: var(--font-semibold);
            text-transform: uppercase;
        }

        .key-badge.pk {
            background: var(--color-logical-bg);
            color: var(--color-logical);
        }

        .key-badge.fk {
            background: var(--color-physical-bg);
            color: var(--color-physical);
        }

        .key-badge.uk {
            background: var(--color-conceptual-bg);
            color: var(--color-conceptual);
        }

        .type-label {
            font-family: var(--font-mono);
            font-size: var(--text-caption);
            color: var(--color-text-secondary);
        }

        /* ===== Project Tab Content ===== */
        .project-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--space-4);
        }

        .project-stat-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            background: var(--color-bg-base);
            border-radius: var(--radius-md);
        }

        .project-stat-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            color: var(--color-text-muted);
            flex-shrink: 0;
        }

        .project-stat-icon svg {
            width: 20px;
            height: 20px;
        }

        .project-stat-content {
            display: flex;
            flex-direction: column;
        }

        .project-stat-value {
            font-size: var(--text-h2);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
            line-height: 1;
        }

        .project-stat-label {
            font-size: var(--text-small);
            color: var(--color-text-secondary);
            margin-top: var(--space-1);
        }

        .project-domains-list {
            display: flex;
            flex-direction: column;
        }

        .project-domain-item {
            display: flex;
            flex-direction: column;
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border-subtle);
            cursor: pointer;
            transition: background var(--duration-fast) var(--ease-out);
        }

        .project-domain-item:last-child {
            border-bottom: none;
        }

        .project-domain-item:hover {
            background: var(--color-bg-hover);
        }

        .domain-name {
            font-weight: var(--font-medium);
            color: var(--color-text-primary);
        }

        .domain-desc {
            font-size: var(--text-small);
            margin-top: var(--space-1);
        }

        .empty-list-message {
            padding: var(--space-6);
            text-align: center;
            color: var(--color-text-muted);
        }

        /* Users Tab */
        .users-list {
            display: flex;
            flex-direction: column;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border-subtle);
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--color-conceptual-bg);
            color: var(--color-conceptual);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-small);
            font-weight: var(--font-semibold);
            flex-shrink: 0;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: var(--font-medium);
            color: var(--color-text-primary);
        }

        .user-email {
            font-size: var(--text-small);
        }

        .user-role {
            flex-shrink: 0;
        }

        .roles-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .role-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .role-name {
            font-weight: var(--font-medium);
            color: var(--color-text-primary);
        }

        .role-desc {
            font-size: var(--text-small);
        }

        /* Settings Tab */
        .settings-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .setting-row {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .setting-toggle-row {
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-2) 0;
        }

        .setting-toggle-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .setting-label {
            font-weight: var(--font-medium);
            color: var(--color-text-primary);
            font-size: var(--text-small);
        }

        .setting-desc {
            font-size: var(--text-small);
        }

        .setting-input,
        .setting-select {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            background: var(--color-bg-base);
            color: var(--color-text-primary);
            font-family: var(--font-sans);
            font-size: var(--text-small);
        }

        .setting-input:disabled,
        .setting-select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .toggle {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
            flex-shrink: 0;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--color-border-default);
            transition: var(--duration-fast);
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: var(--duration-fast);
            border-radius: 50%;
        }

        .toggle input:checked + .toggle-slider {
            background-color: var(--color-logical);
        }

        .toggle input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .toggle input:disabled + .toggle-slider {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Danger Zone */
        .danger-zone {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .danger-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            gap: var(--space-4);
        }

        .danger-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .danger-title {
            font-weight: var(--font-medium);
            color: var(--color-text-primary);
        }

        .danger-desc {
            font-size: var(--text-small);
        }

        .btn {
            padding: var(--space-2) var(--space-4);
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-sans);
            font-size: var(--text-small);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
            white-space: nowrap;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-outline-danger {
            background: transparent;
            border: 1px solid #DC2626;
            color: #DC2626;
        }

        .btn-outline-danger:hover:not(:disabled) {
            background: #FEF2F2;
        }

        .btn-danger {
            background: #DC2626;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #B91C1C;
        }

        /* ===== Empty State ===== */
        .empty-state {
            text-align: center;
            padding: var(--space-12);
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: var(--text-h3);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-2);
        }

        /* ===== Placeholder Views ===== */
        .placeholder-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            background: var(--color-bg-surface);
            border: 2px dashed var(--color-border-default);
            border-radius: var(--radius-lg);
            color: var(--color-text-secondary);
        }

        .placeholder-icon {
            font-size: 48px;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        .placeholder-title {
            font-size: var(--text-h3);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-2);
        }

        .placeholder-desc {
            color: var(--color-text-muted);
        }

        /* ===== Search Results ===== */
        .search-results {
            position: absolute;
            top: 100%;
            right: 0;
            width: 320px;
            background: var(--color-bg-elevated);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            margin-top: var(--space-1);
            max-height: 400px;
            overflow-y: auto;
            z-index: 200;
            display: none;
            box-shadow: var(--shadow-lg);
        }

        .search-results.active {
            display: block;
        }

        .search-results-header {
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-caption);
            color: var(--color-text-muted);
            border-bottom: 1px solid var(--color-border-default);
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            cursor: pointer;
            transition: background-color var(--duration-fast) var(--ease-out);
        }

        .search-result-item:hover {
            background: var(--color-bg-hover);
        }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-name {
            font-weight: var(--font-medium);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .search-result-meta {
            font-size: var(--text-caption);
            color: var(--color-text-muted);
        }

        /* ===== Scrollbar ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--color-bg-base);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-border-default);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-bg-hover);
        }

        /* ========================================
           Responsive Design
           ======================================== */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: var(--header-height);
                bottom: 0;
                z-index: 50;
                transform: translateX(0);
                transition: transform var(--duration-slow) var(--ease-in-out);
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
            }

            .sidebar-overlay {
                position: fixed;
                inset: 0;
                top: var(--header-height);
                background: rgba(0, 0, 0, 0.5);
                z-index: 40;
                display: none;
            }

            .sidebar-overlay.active {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .layer-tabs {
                display: none;
            }

            .header {
                gap: var(--space-3);
            }

            .logo span {
                display: none;
            }

            .content-area {
                padding: var(--space-4);
            }

            .meta-grid {
                grid-template-columns: 1fr;
                gap: var(--space-2);
            }

            .meta-label {
                margin-top: var(--space-2);
            }

            .breadcrumb {
                padding: 0;
            }

            .data-table {
                display: block;
                overflow-x: auto;
            }
        }

        /* ========================================
           SVG Icons (inline)
           ======================================== */
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            vertical-align: middle;
        }

        /* ========================================
           Project Overview Page
           ======================================== */
        .projects-overview {
            max-width: 900px;
            margin: 0 auto;
        }

        .projects-header {
            margin-bottom: var(--space-6);
            text-align: center;
        }

        .projects-title {
            font-size: var(--text-h1);
            font-weight: var(--font-semibold);
            line-height: var(--leading-h1);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-2);
            color: var(--color-text-primary);
        }

        .projects-subtitle {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            max-width: 480px;
            margin: 0 auto;
            line-height: var(--leading-body);
        }

        .projects-stats {
            display: flex;
            gap: var(--space-6);
            margin-top: var(--space-6);
            padding: var(--space-4) var(--space-5);
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-lg);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: var(--text-h1);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
        }

        .stat-label {
            font-size: var(--text-caption);
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-4);
        }

        .project-card {
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
        }

        .project-card:hover {
            border-color: var(--color-text-muted);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .project-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
        }

        .project-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            background: var(--project-color, var(--color-conceptual));
            color: white;
        }

        .project-info {
            flex: 1;
            min-width: 0;
        }

        .project-name {
            font-size: var(--text-body);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            margin-bottom: 2px;
            line-height: 1.3;
        }

        .project-owner {
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        .project-status {
            padding: 3px 8px;
            border-radius: var(--radius-full);
            font-size: 10px;
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            flex-shrink: 0;
        }

        .project-status.active {
            background: var(--color-logical-bg);
            color: var(--color-logical);
        }

        .project-status.draft {
            background: var(--color-physical-bg);
            color: var(--color-physical);
        }

        .project-status.archived {
            background: var(--color-bg-hover);
            color: var(--color-text-muted);
        }

        .project-description {
            font-size: var(--text-small);
            color: var(--color-text-secondary);
            line-height: 1.5;
            margin-bottom: var(--space-4);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .project-meta {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding-top: var(--space-3);
            border-top: 1px solid var(--color-border-subtle);
        }

        .project-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        .project-meta-item svg {
            width: 14px;
            height: 14px;
            opacity: 0.8;
        }

        .project-meta-value {
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
        }

        .project-activity {
            margin-left: auto;
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        /* Project page specific breadcrumb */
        .breadcrumb-home {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .breadcrumb-home:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-hover);
        }

        .breadcrumb-home svg {
            width: 14px;
            height: 14px;
        }

        @media (max-width: 768px) {
            .projects-grid {
                grid-template-columns: 1fr;
            }

            .projects-stats {
                flex-wrap: wrap;
                gap: var(--space-4);
            }

            .stat-item {
                flex: 1;
                min-width: 80px;
            }
        }

        /* ========================================
           Projects Overview Mode
           Hide sidebar and search when viewing all projects
           ======================================== */
        .projects-overview-mode .sidebar {
            display: none;
        }

        .projects-overview-mode .sub-header {
            display: none;
        }

        .projects-overview-mode .header-right {
            margin-left: auto;
        }

        .projects-overview-mode .breadcrumb {
            display: none;
        }

        .projects-overview-mode .main-content {
            padding: var(--space-8);
        }

        /* ========================================
           Layer Overview Page
           ======================================== */
        .layer-overview {
            max-width: 960px;
            margin: 0 auto;
        }

        .layer-overview-header {
            margin-bottom: var(--space-6);
        }

        .layer-overview-title {
            font-size: var(--text-h1);
            font-weight: var(--font-semibold);
            line-height: var(--leading-h1);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-2);
        }

        .layer-overview-subtitle {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            max-width: 560px;
            line-height: var(--leading-body);
        }

        /* ===== KPI Cards ===== */
        .kpi-cards {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .kpi-card {
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-lg);
            padding: var(--space-4) var(--space-5);
            min-width: 120px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all var(--duration-fast) var(--ease-out);
        }

        .kpi-card:hover {
            border-color: var(--color-text-muted);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--kpi-color, var(--color-conceptual));
        }

        .kpi-value {
            font-size: var(--text-h1);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            line-height: 1;
            margin-bottom: var(--space-1);
        }

        .kpi-label {
            font-size: 11px;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            font-weight: var(--font-medium);
        }

        /* ===== Layer Entities List ===== */
        .layer-entities-section {
            margin-top: var(--space-6);
        }

        .layer-entities-title {
            font-size: var(--text-small);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-3);
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .layer-entities-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .layer-entity-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
        }

        .layer-entity-item:hover {
            background: var(--color-bg-hover);
            transform: translateX(2px);
        }

        .layer-entity-badge {
            padding: 2px var(--space-2);
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            min-width: 60px;
            text-align: center;
        }

        .layer-entity-badge.conceptual {
            background: var(--color-conceptual-bg);
            color: var(--color-conceptual);
        }

        .layer-entity-badge.logical {
            background: var(--color-logical-bg);
            color: var(--color-logical);
        }

        .layer-entity-badge.physical {
            background: var(--color-physical-bg);
            color: var(--color-physical);
        }

        .layer-entity-name {
            flex: 1;
            font-weight: var(--font-medium);
            color: var(--color-text-primary);
        }

        .layer-entity-status {
            font-size: var(--text-caption);
            padding: 2px var(--space-2);
            border-radius: var(--radius-full);
            text-transform: capitalize;
        }

        .layer-entity-status.active {
            background: var(--color-logical-bg);
            color: var(--color-logical);
        }

        .layer-entity-status.draft {
            background: var(--color-physical-bg);
            color: var(--color-physical);
        }

        .layer-entity-status.deprecated {
            background: var(--color-bg-hover);
            color: var(--color-text-muted);
        }

        @media (max-width: 768px) {
            .kpi-cards {
                flex-wrap: wrap;
            }

            .kpi-card {
                flex: 1;
                min-width: 100px;
            }
        }

        /* ===== Global Animations ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .layer-entity-item,
        .project-card,
        .card {
            animation: fadeIn var(--duration-normal) var(--ease-out);
        }

        /* ===== Selection styles ===== */
        ::selection {
            background: var(--color-conceptual-bg);
            color: var(--color-text-primary);
        }
    </style>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div id="app" class="loading">
        <div class="loading-spinner"></div>
        <span>Loading Meta-Atlas...</span>
    </div>

    <script>
        // ========================================
        // SVG Icons
        // ========================================
        const icons = {
            search: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',
            chevronRight: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>',
            chevronDown: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>',
            panelLeft: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M9 3v18"/></svg>',
            sun: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>',
            moon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>',
            arrowRight: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>',
            folder: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg>',
            lightbulb: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>',
            box: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>',
            database: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>',
            server: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>',
            table: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18"/><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/></svg>',
            hash: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></svg>',
            building: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M16 10h.01"/><path d="M16 14h.01"/><path d="M8 10h.01"/><path d="M8 14h.01"/></svg>',
            map: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 6 6-3 6 3 6-3v15l-6 3-6-3-6 3z"/><path d="M9 3v15"/><path d="M15 6v15"/></svg>',
            chart: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>',
            users: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
            hammer: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91"/></svg>',
            home: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>',
            layers: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>',
            cube: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21 16-9 5-9-5V8l9-5 9 5z"/><path d="m3 8 9 5 9-5"/><path d="M12 13v8"/></svg>'
        };

        // ========================================
        // Data Loading
        // ========================================
        const data = {
            projects: [],
            domains: [],
            concepts: [],
            entities: [],
            systems: [],
            tables: []
        };

        async function loadData() {
            try {
                const [projects, domains, concepts, entities, systems, tables] = await Promise.all([
                    fetch('data/projects.json').then(r => r.json()),
                    fetch('data/domains.json').then(r => r.json()),
                    fetch('data/concepts.json').then(r => r.json()),
                    fetch('data/entities.json').then(r => r.json()),
                    fetch('data/systems.json').then(r => r.json()),
                    fetch('data/tables.json').then(r => r.json())
                ]);

                data.projects = projects;
                data.domains = domains;
                data.concepts = concepts;
                data.entities = entities;
                data.systems = systems;
                data.tables = tables;

                return true;
            } catch (error) {
                console.error('Failed to load data:', error);
                return false;
            }
        }

        // ========================================
        // State Management
        // ========================================
        let state = {
            currentProject: null,
            currentLayer: 'conceptual',
            currentView: 'wiki',
            projectView: 'details',
            selectedItem: null,
            expandedNodes: new Set(['dom-immo', 'sys-sap']),
            expandedLayers: new Set(['conceptual', 'logical', 'physical']),
            theme: 'light',
            sidebarCollapsed: false,
            searchQuery: '',
            searchResults: [],
            showProjectsOverview: true,
            groupBy: 'layer'
        };

        // ========================================
        // URL Routing
        // ========================================
        function parseRoute() {
            const hash = window.location.hash.slice(1) || '/';
            const [path, queryString] = hash.split('?');
            const parts = path.split('/').filter(Boolean);
            const params = new URLSearchParams(queryString || '');

            return { parts, params };
        }

        function navigateTo(path, replace = false) {
            const method = replace ? 'replaceState' : 'pushState';
            history[method](null, '', `#${path}`);
            handleRoute();
        }

        function handleRoute() {
            const { parts, params } = parseRoute();

            if (parts.length === 0) {
                // Default route - show projects overview
                state.currentLayer = 'conceptual';
                state.selectedItem = null;
                state.currentProject = null;
                state.showProjectsOverview = true;
            } else if (parts.length === 1) {
                // Layer route: /conceptual, /logical, /physical
                if (['conceptual', 'logical', 'physical'].includes(parts[0])) {
                    state.currentLayer = parts[0];
                    state.selectedItem = null;
                    state.showProjectsOverview = false;
                }
            } else if (parts.length >= 2) {
                // Entity route: /conceptual/domain/dom-immo or /project/proj-id
                const [layer, type, id] = parts;
                state.showProjectsOverview = false;
                if (['conceptual', 'logical', 'physical'].includes(layer)) {
                    state.currentLayer = layer;
                    if (id) {
                        const item = findItemById(id);
                        if (item) {
                            state.selectedItem = item;
                            expandParents(item);
                        }
                    }
                } else if (layer === 'project' && type) {
                    const project = data.projects.find(p => p.id === type);
                    if (project) {
                        state.currentProject = project;
                        state.selectedItem = project;
                    }
                }
            }

            // Handle query params
            if (params.has('tab')) {
                state.currentView = params.get('tab');
            }

            updateLayoutForView();
            renderAll();
        }

        function expandParents(item) {
            // Expand parent nodes in tree
            if (item.domain) state.expandedNodes.add(item.domain);
            if (item.system) state.expandedNodes.add(item.system);
        }

        // ========================================
        // Utility Functions
        // ========================================
        function findItemById(id) {
            for (const project of data.projects) {
                if (project.id === id) return project;
            }
            for (const domain of data.domains) {
                if (domain.id === id) return domain;
            }
            for (const concept of data.concepts) {
                if (concept.id === id) return concept;
            }
            for (const entity of data.entities) {
                if (entity.id === id) return entity;
            }
            for (const system of data.systems) {
                if (system.id === id) return system;
            }
            for (const table of data.tables) {
                if (table.id === id) return table;
            }
            return null;
        }

        function getConceptsForDomain(domainId) {
            return data.concepts.filter(c => c.domain === domainId);
        }

        function getTablesForSystem(systemId) {
            return data.tables.filter(t => t.system === systemId);
        }

        function getParentChain(item) {
            const chain = [];
            if (item.layer === 'conceptual') {
                if (item.type === 'concept') {
                    const domain = data.domains.find(d => d.id === item.domain);
                    if (domain) chain.push(domain);
                }
            } else if (item.layer === 'physical') {
                if (item.type === 'table') {
                    const system = data.systems.find(sys => sys.id === item.system);
                    if (system) chain.push(system);
                }
            }
            return chain;
        }

        function getTypeLabel(type) {
            const labels = {
                project: 'Project',
                domain: 'Domain',
                concept: 'Concept',
                entity: 'Logical Entity',
                system: 'System',
                table: 'Table'
            };
            return labels[type] || type;
        }

        function getTypeIcon(type) {
            const iconMap = {
                project: 'P',
                domain: 'D',
                concept: 'C',
                entity: 'E',
                system: 'S',
                table: 'T'
            };
            return iconMap[type] || '?';
        }

        function getTreeIcon(type) {
            const iconMap = {
                domain: icons.folder,
                concept: icons.lightbulb,
                entity: icons.cube,
                system: icons.server,
                table: icons.table
            };
            return iconMap[type] || '';
        }

        // ========================================
        // Search with Debounce
        // ========================================
        let searchTimeout = null;

        function handleSearch(query) {
            clearTimeout(searchTimeout);
            state.searchQuery = query;

            if (!query || query.length < 2) {
                state.searchResults = [];
                renderSearchResults();
                return;
            }

            searchTimeout = setTimeout(() => {
                const q = query.toLowerCase();
                state.searchResults = getAllItems()
                    .filter(item =>
                        item.name.toLowerCase().includes(q) ||
                        item.description?.toLowerCase().includes(q) ||
                        item.nameDE?.toLowerCase().includes(q) ||
                        item.nameEn?.toLowerCase().includes(q)
                    )
                    .slice(0, 10);
                renderSearchResults();
            }, 300);
        }

        function getAllItems() {
            return [
                ...data.projects,
                ...data.domains,
                ...data.concepts,
                ...data.entities,
                ...data.systems,
                ...data.tables
            ];
        }

        // ========================================
        // Render Functions
        // ========================================
        function renderAll() {
            renderSubHeader();
            renderTree();
            renderContent();
        }

        function renderApp() {
            const app = document.getElementById('app');
            app.className = 'app-container';
            app.innerHTML = `
                <!-- Header -->
                <header class="header" role="banner">
                    <a href="#/" class="logo" onclick="goToProjectsOverview(); return false;">
                        <div class="logo-icon" aria-hidden="true">${icons.layers}</div>
                        <span>Meta-Atlas</span>
                    </a>

                    <div class="header-right">
                        <div class="search-container">
                            <button class="search-toggle" id="searchToggle" aria-label="Search">
                                ${icons.search}
                            </button>
                            <div class="search-wrapper">
                                <input type="search"
                                       class="search-input"
                                       id="searchInput"
                                       placeholder="Suchen..."
                                       aria-label="Metadatenkatalog durchsuchen"
                                       autocomplete="off">
                                <div class="search-results" id="searchResults" role="listbox"></div>
                            </div>
                        </div>
                        <select class="lang-selector" aria-label="Language">
                            <option value="de">DE</option>
                            <option value="fr">FR</option>
                            <option value="it">IT</option>
                            <option value="en">EN</option>
                        </select>
                        <button class="icon-btn" id="themeToggle" aria-label="Toggle dark/light theme">
                            ${icons.sun}
                        </button>
                    </div>
                </header>

                <!-- Sub Header -->
                <div class="sub-header" id="subHeader">
                    <div class="sub-header-inner">
                        <div class="sub-header-left">
                            <select class="version-selector" id="versionSelector" aria-label="Select version">
                                <!-- Version options will be rendered here -->
                            </select>
                        </div>
                        <div class="sub-header-right">
                            <nav class="view-tabs" id="viewTabs" role="tablist">
                                <!-- View tabs will be rendered here -->
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Main Layout -->
                <div class="main-layout">
                    <div class="sidebar-overlay" id="sidebarOverlay"></div>

                    <!-- Sidebar -->
                    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Entity navigation">
                        <div class="sidebar-header">
                            <div class="group-by-dropdown" id="groupByDropdown">
                                <button class="group-by-trigger" id="groupByTrigger" aria-haspopup="listbox" aria-expanded="false">
                                    <span class="group-by-trigger-icon">${icons.layers}</span>
                                    <span class="group-by-trigger-text">Nach Schicht</span>
                                    <span class="group-by-trigger-arrow">${icons.chevronDown}</span>
                                </button>
                                <div class="group-by-menu" id="groupByMenu" role="listbox">
                                    <button class="group-by-option selected" data-value="layer" role="option">
                                        <span class="group-by-option-icon">${icons.layers}</span>
                                        <span>Nach Schicht</span>
                                    </button>
                                    <button class="group-by-option" data-value="system" role="option">
                                        <span class="group-by-option-icon">${icons.server}</span>
                                        <span>Nach System</span>
                                    </button>
                                    <button class="group-by-option" data-value="domain" role="option">
                                        <span class="group-by-option-icon">${icons.folder}</span>
                                        <span>Nach Domne</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="tree-container" id="treeContainer" role="tree">
                            <!-- Tree will be rendered here -->
                        </div>
                        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                            ${icons.panelLeft}
                        </button>
                    </aside>

                    <!-- Main Content -->
                    <main class="main-content" id="main-content">
                        <div class="content-area" id="contentArea">
                            <nav class="breadcrumb" id="breadcrumb" aria-label="Breadcrumb">
                                <!-- Breadcrumb will be rendered here -->
                            </nav>
                            <div id="contentBody">
                                <!-- Content will be rendered here -->
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        function renderSubHeader() {
            const versionSelector = document.getElementById('versionSelector');
            const viewTabs = document.getElementById('viewTabs');

            if (versionSelector) {
                // Placeholder versions - to be implemented with actual version data
                const versions = [
                    { id: 'main', label: 'main' },
                    { id: 'draft', label: 'draft' },
                    { id: 'v1.0', label: 'v1.0' }
                ];
                versionSelector.innerHTML = versions.map(v =>
                    `<option value="${v.id}" ${v.id === 'main' ? 'selected' : ''}>${v.label}</option>`
                ).join('');
            }

            if (viewTabs) {
                // Only show view tabs when viewing non-project items (entities, concepts, tables, etc.)
                const isViewingProject = state.selectedItem?.type === 'project';

                if (isViewingProject || !state.selectedItem) {
                    viewTabs.innerHTML = '';
                    viewTabs.style.display = 'none';
                } else {
                    viewTabs.style.display = 'flex';
                    const tabs = [
                        { id: 'wiki', label: 'Details' },
                        { id: 'diagram', label: 'Diagramm' },
                        { id: 'history', label: 'Verlauf' }
                    ];

                    viewTabs.innerHTML = tabs.map(tab => `
                        <button class="view-tab ${state.currentView === tab.id ? 'active' : ''}"
                                data-view="${tab.id}"
                                role="tab"
                                aria-selected="${state.currentView === tab.id}">
                            ${tab.label}
                        </button>
                    `).join('');
                }
            }
        }

        function attachSubHeaderListeners() {
            const versionSelector = document.getElementById('versionSelector');
            const viewTabs = document.getElementById('viewTabs');

            if (versionSelector) {
                versionSelector.addEventListener('change', (e) => {
                    const versionId = e.target.value;
                    // TODO: Implement version switching logic
                    console.log('Version changed to:', versionId);
                });
            }

            if (viewTabs) {
                viewTabs.addEventListener('click', (e) => {
                    const tab = e.target.closest('.view-tab');
                    if (tab) {
                        state.currentView = tab.dataset.view;
                        renderSubHeader();
                        renderContent();
                    }
                });
            }
        }

        function renderTree() {
            const container = document.getElementById('treeContainer');
            if (!container) return;

            let html = '';

            // Conceptual Layer Section
            const isConceptualExpanded = state.expandedLayers.has('conceptual');
            html += `
                <div class="layer-section">
                    <div class="layer-section-header conceptual ${!isConceptualExpanded ? 'collapsed' : ''}" data-layer="conceptual">
                        <span class="layer-toggle">${icons.chevronDown}</span>
                        <span>Konzeptuell</span>
                    </div>
                    <div class="layer-section-content ${!isConceptualExpanded ? 'collapsed' : ''}">
            `;
            for (const domain of data.domains) {
                const concepts = getConceptsForDomain(domain.id);
                html += renderTreeItem(domain, concepts);
            }
            html += `</div></div>`;

            // Logical Layer Section
            const isLogicalExpanded = state.expandedLayers.has('logical');
            html += `
                <div class="layer-section">
                    <div class="layer-section-header logical ${!isLogicalExpanded ? 'collapsed' : ''}" data-layer="logical">
                        <span class="layer-toggle">${icons.chevronDown}</span>
                        <span>Logisch</span>
                    </div>
                    <div class="layer-section-content ${!isLogicalExpanded ? 'collapsed' : ''}">
            `;
            for (const entity of data.entities) {
                html += renderTreeEntityWithAttributes(entity);
            }
            html += `</div></div>`;

            // Physical Layer Section
            const isPhysicalExpanded = state.expandedLayers.has('physical');
            html += `
                <div class="layer-section">
                    <div class="layer-section-header physical ${!isPhysicalExpanded ? 'collapsed' : ''}" data-layer="physical">
                        <span class="layer-toggle">${icons.chevronDown}</span>
                        <span>Physisch</span>
                    </div>
                    <div class="layer-section-content ${!isPhysicalExpanded ? 'collapsed' : ''}">
            `;
            for (const system of data.systems) {
                const tables = getTablesForSystem(system.id);
                html += renderTreeItemWithTables(system, tables);
            }
            html += `</div></div>`;

            container.innerHTML = html;
            attachTreeListeners();
            attachLayerToggleListeners();
        }

        function attachLayerToggleListeners() {
            document.querySelectorAll('.layer-section-header').forEach(header => {
                header.addEventListener('click', () => {
                    const layer = header.dataset.layer;
                    if (state.expandedLayers.has(layer)) {
                        state.expandedLayers.delete(layer);
                    } else {
                        state.expandedLayers.add(layer);
                    }
                    renderTree();
                });
            });
        }

        function renderTreeItem(item, children) {
            const isExpanded = state.expandedNodes.has(item.id);
            const isSelected = state.selectedItem?.id === item.id;
            const hasChildren = children && children.length > 0;

            let childrenHtml = '';
            if (hasChildren) {
                for (const child of children) {
                    childrenHtml += renderTreeLeaf(child);
                }
            }

            return `
                <div class="tree-item" data-id="${item.id}">
                    <div class="tree-node ${item.layer} ${isSelected ? 'selected ' + item.layer : ''}"
                         data-id="${item.id}"
                         data-layer="${item.layer}"
                         role="treeitem"
                         aria-expanded="${isExpanded}"
                         aria-selected="${isSelected}">
                        <span class="tree-toggle ${isExpanded ? 'expanded' : ''}" aria-hidden="true">
                            ${hasChildren ? icons.chevronRight : ''}
                        </span>
                        <span class="tree-icon">${getTreeIcon(item.type)}</span>
                        <span class="tree-label">${item.name}</span>
                        ${hasChildren ? `<span class="tree-count">${children.length}</span>` : ''}
                    </div>
                    <div class="tree-children ${isExpanded ? 'expanded' : ''}" role="group" data-parent="${item.id}">
                        ${childrenHtml}
                    </div>
                </div>
            `;
        }

        function renderTreeItemWithTables(system, tables) {
            const isExpanded = state.expandedNodes.has(system.id);
            const isSelected = state.selectedItem?.id === system.id;
            const hasChildren = tables && tables.length > 0;

            // Calculate total column count across all tables
            const totalColumns = tables.reduce((sum, table) => sum + (table.columns?.length || 0), 0);

            let tablesHtml = '';
            for (const table of tables) {
                tablesHtml += renderTreeTableWithColumns(table);
            }

            return `
                <div class="tree-item" data-id="${system.id}">
                    <div class="tree-node ${system.layer} ${isSelected ? 'selected ' + system.layer : ''}"
                         data-id="${system.id}"
                         data-layer="${system.layer}"
                         role="treeitem"
                         aria-expanded="${isExpanded}"
                         aria-selected="${isSelected}">
                        <span class="tree-toggle ${isExpanded ? 'expanded' : ''}" aria-hidden="true">
                            ${hasChildren ? icons.chevronRight : ''}
                        </span>
                        <span class="tree-icon">${getTreeIcon(system.type)}</span>
                        <span class="tree-label">${system.name}</span>
                        ${totalColumns > 0 ? `<span class="tree-count">${totalColumns}</span>` : ''}
                    </div>
                    <div class="tree-children ${isExpanded ? 'expanded' : ''}" role="group" data-parent="${system.id}">
                        ${tablesHtml}
                    </div>
                </div>
            `;
        }

        function renderTreeLeaf(item) {
            const isSelected = state.selectedItem?.id === item.id;
            return `
                <div class="tree-item" data-id="${item.id}">
                    <div class="tree-node ${item.layer} ${isSelected ? 'selected ' + item.layer : ''}"
                         data-id="${item.id}"
                         data-layer="${item.layer}"
                         role="treeitem"
                         aria-selected="${isSelected}">
                        <span class="tree-toggle" aria-hidden="true"></span>
                        <span class="tree-icon">${getTreeIcon(item.type)}</span>
                        <span class="tree-label">${item.name}</span>
                    </div>
                </div>
            `;
        }

        function renderTreeEntityWithAttributes(entity) {
            const isExpanded = state.expandedNodes.has(entity.id);
            const isSelected = state.selectedItem?.id === entity.id;
            const attributes = entity.attributes || [];
            const hasChildren = attributes.length > 0;

            let attributesHtml = '';
            if (hasChildren) {
                for (const attr of attributes) {
                    attributesHtml += renderTreeAttribute(attr, entity.id);
                }
            }

            return `
                <div class="tree-item" data-id="${entity.id}">
                    <div class="tree-node ${entity.layer} ${isSelected ? 'selected ' + entity.layer : ''}"
                         data-id="${entity.id}"
                         data-layer="${entity.layer}"
                         role="treeitem"
                         aria-expanded="${isExpanded}"
                         aria-selected="${isSelected}">
                        <span class="tree-toggle ${isExpanded ? 'expanded' : ''}" aria-hidden="true">
                            ${hasChildren ? icons.chevronRight : ''}
                        </span>
                        <span class="tree-icon">${getTreeIcon(entity.type)}</span>
                        <span class="tree-label">${entity.name}</span>
                        ${hasChildren ? `<span class="tree-count">${attributes.length}</span>` : ''}
                    </div>
                    <div class="tree-children ${isExpanded ? 'expanded' : ''}" role="group" data-parent="${entity.id}">
                        ${attributesHtml}
                    </div>
                </div>
            `;
        }

        function renderTreeAttribute(attr, entityId) {
            const attrId = `${entityId}-attr-${attr.name}`;
            return `
                <div class="tree-item tree-attribute" data-id="${attrId}" data-entity="${entityId}" data-attr-name="${attr.name}">
                    <div class="tree-node attribute-node"
                         data-id="${attrId}"
                         data-entity="${entityId}"
                         data-attr-name="${attr.name}"
                         role="treeitem">
                        <span class="tree-toggle" aria-hidden="true"></span>
                        <span class="tree-icon">${icons.hash}</span>
                        <span class="tree-label">${attr.name}</span>
                    </div>
                </div>
            `;
        }

        function renderTreeTableWithColumns(table) {
            const isExpanded = state.expandedNodes.has(table.id);
            const isSelected = state.selectedItem?.id === table.id;
            const columns = table.columns || [];
            const hasChildren = columns.length > 0;

            let columnsHtml = '';
            if (hasChildren) {
                for (const col of columns) {
                    columnsHtml += renderTreeColumn(col, table.id);
                }
            }

            return `
                <div class="tree-item" data-id="${table.id}">
                    <div class="tree-node ${table.layer} ${isSelected ? 'selected ' + table.layer : ''}"
                         data-id="${table.id}"
                         data-layer="${table.layer}"
                         role="treeitem"
                         aria-expanded="${isExpanded}"
                         aria-selected="${isSelected}">
                        <span class="tree-toggle ${isExpanded ? 'expanded' : ''}" aria-hidden="true">
                            ${hasChildren ? icons.chevronRight : ''}
                        </span>
                        <span class="tree-icon">${getTreeIcon(table.type)}</span>
                        <span class="tree-label">${table.name}</span>
                        ${hasChildren ? `<span class="tree-count">${columns.length}</span>` : ''}
                    </div>
                    <div class="tree-children ${isExpanded ? 'expanded' : ''}" role="group" data-parent="${table.id}">
                        ${columnsHtml}
                    </div>
                </div>
            `;
        }

        function renderTreeColumn(col, tableId) {
            const colId = `${tableId}-col-${col.name}`;
            return `
                <div class="tree-item tree-column" data-id="${colId}" data-table="${tableId}" data-col-name="${col.name}">
                    <div class="tree-node column-node"
                         data-id="${colId}"
                         data-table="${tableId}"
                         data-col-name="${col.name}"
                         role="treeitem">
                        <span class="tree-toggle" aria-hidden="true"></span>
                        <span class="tree-icon">${icons.hash}</span>
                        <span class="tree-label">${col.name}</span>
                    </div>
                </div>
            `;
        }

        function renderBreadcrumb(item) {
            const breadcrumb = document.getElementById('breadcrumb');
            if (!breadcrumb) return;

            let html = '';

            // Always show "Alle Projekte" as the first breadcrumb item
            html += `<span class="breadcrumb-home" data-action="home" tabindex="0">${icons.home} Alle Projekte</span>`;

            if (!item) {
                breadcrumb.innerHTML = html;
                attachBreadcrumbListeners(breadcrumb);
                return;
            }

            // Add separator after "Alle Projekte"
            html += `<span class="breadcrumb-separator" aria-hidden="true">/</span>`;

            // If we have a current project and the item is not the project itself, show the project
            if (state.currentProject && item.type !== 'project') {
                html += `<span class="breadcrumb-item" data-id="${state.currentProject.id}" tabindex="0">${state.currentProject.name}</span>`;
                html += `<span class="breadcrumb-separator" aria-hidden="true">/</span>`;
            }

            // If item is a project, just show it as current
            if (item.type === 'project') {
                html += `<span class="breadcrumb-current" aria-current="page">${item.name}</span>`;
                breadcrumb.innerHTML = html;
                attachBreadcrumbListeners(breadcrumb);
                return;
            }

            // Add layer indicator
            if (item.layer) {
                html += `<span class="breadcrumb-item layer-${item.layer}" data-layer="${item.layer}" tabindex="0">${item.layer.charAt(0).toUpperCase() + item.layer.slice(1)}</span>`;
                html += `<span class="breadcrumb-separator" aria-hidden="true">/</span>`;
            }

            // Add parent chain
            const chain = getParentChain(item);
            html += chain.map(parent =>
                `<span class="breadcrumb-item" data-id="${parent.id}" tabindex="0">${parent.name}</span>
                 <span class="breadcrumb-separator" aria-hidden="true">/</span>`
            ).join('');

            html += `<span class="breadcrumb-current" aria-current="page">${item.name}</span>`;
            breadcrumb.innerHTML = html;
            attachBreadcrumbListeners(breadcrumb);
        }

        function attachBreadcrumbListeners(breadcrumb) {
            // Home button listener
            breadcrumb.querySelectorAll('.breadcrumb-home').forEach(el => {
                el.addEventListener('click', () => goToProjectsOverview());
                el.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        goToProjectsOverview();
                    }
                });
            });

            // Item listeners
            breadcrumb.querySelectorAll('.breadcrumb-item').forEach(el => {
                el.addEventListener('click', () => {
                    if (el.dataset.id) {
                        selectItem(el.dataset.id);
                    } else if (el.dataset.layer) {
                        state.currentLayer = el.dataset.layer;
                        renderAll();
                    }
                });
                el.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        if (el.dataset.id) {
                            selectItem(el.dataset.id);
                        }
                    }
                });
            });
        }

        function goToProjectsOverview() {
            state.currentProject = null;
            state.selectedItem = null;
            state.showProjectsOverview = true;
            updateLayoutForView();
            navigateTo('/');
        }

        function updateLayoutForView() {
            const appContainer = document.querySelector('.app-container');
            if (state.showProjectsOverview) {
                appContainer?.classList.add('projects-overview-mode');
            } else {
                appContainer?.classList.remove('projects-overview-mode');
            }
        }

        function renderProjectsOverview() {
            const contentArea = document.getElementById('contentArea');
            if (!contentArea) return;

            const container = document.getElementById('contentBody');
            container.innerHTML = `
                <div class="projects-overview">
                    <div class="projects-header">
                        <h1 class="projects-title">Alle Projekte</h1>
                        <p class="projects-subtitle">Erkunden Sie Metadatenkataloge Ihrer Organisation. Jedes Projekt enthlt Domnen, Entitten und physische Implementierungen.</p>
                    </div>
                    <div class="projects-grid">
                        ${data.projects.map(project => renderProjectCard(project)).join('')}
                    </div>
                </div>
            `;

            // Attach project card listeners
            container.querySelectorAll('.project-card').forEach(card => {
                card.addEventListener('click', () => {
                    const projectId = card.dataset.id;
                    selectProject(projectId);
                });
            });
        }

        function renderProjectCard(project) {
            return `
                <div class="project-card" data-id="${project.id}" style="--project-color: ${project.color || '#3B82F6'}">
                    <div class="project-card-header">
                        <div class="project-info">
                            <div class="project-name">${project.name}</div>
                            <div class="project-owner">${project.owner}</div>
                        </div>
                        <span class="project-status ${project.status}">${project.status}</span>
                    </div>
                    <p class="project-description">${project.description}</p>
                    <div class="project-meta">
                        <div class="project-meta-item">
                            ${icons.box}
                            <span class="project-meta-value">${project.entities || 0}</span> Entities
                        </div>
                        <div class="project-meta-item">
                            ${icons.table}
                            <span class="project-meta-value">${project.tables || 0}</span> Tables
                        </div>
                        <div class="project-activity">
                            Last active: ${project.lastActivity || project.updated || project.created}
                        </div>
                    </div>
                </div>
            `;
        }

        function selectProject(projectId) {
            const project = data.projects.find(p => p.id === projectId);
            if (project) {
                state.currentProject = project;
                state.selectedItem = project;
                state.showProjectsOverview = false;
                updateLayoutForView();
                navigateTo(`/project/${project.id}`);
            }
        }

        function renderLayerOverview(layer) {
            const contentArea = document.getElementById('contentArea');
            if (!contentArea) return;

            const layerConfig = {
                conceptual: {
                    title: 'Konzeptuelle Schicht',
                    subtitle: 'Geschftsdomnen und Konzepte, die das Datenvokabular Ihrer Organisation definieren.',
                    color: 'var(--color-conceptual)',
                    items: [...data.domains, ...data.concepts],
                    kpis: [
                        { label: 'Domnen', value: data.domains.length },
                        { label: 'Konzepte', value: data.concepts.length },
                        { label: 'Aktiv', value: [...data.domains, ...data.concepts].filter(i => i.status === 'active').length }
                    ]
                },
                logical: {
                    title: 'Logische Schicht',
                    subtitle: 'Technologieunabhngige Datenstrukturen und ihre Beziehungen.',
                    color: 'var(--color-logical)',
                    items: data.entities,
                    kpis: [
                        { label: 'Entitten', value: data.entities.length },
                        { label: 'Attribute', value: data.entities.reduce((sum, e) => sum + (e.attributes?.length || 0), 0) },
                        { label: 'Aktiv', value: data.entities.filter(i => i.status === 'active').length }
                    ]
                },
                physical: {
                    title: 'Physische Schicht',
                    subtitle: 'Datenbanksysteme und Tabellen, die Ihre Daten speichern.',
                    color: 'var(--color-physical)',
                    items: [...data.systems, ...data.tables],
                    kpis: [
                        { label: 'Systeme', value: data.systems.length },
                        { label: 'Tabellen', value: data.tables.length },
                        { label: 'Spalten', value: data.tables.reduce((sum, t) => sum + (t.columns?.length || 0), 0) }
                    ]
                }
            };

            const config = layerConfig[layer];
            if (!config) return;

            const container = document.getElementById('contentBody');
            container.innerHTML = `
                <div class="layer-overview">
                    <div class="layer-overview-header">
                        <h1 class="layer-overview-title" style="color: ${config.color}">${config.title}</h1>
                        <p class="layer-overview-subtitle">${config.subtitle}</p>
                    </div>
                    <div class="kpi-cards">
                        ${config.kpis.map(kpi => `
                            <div class="kpi-card" style="--kpi-color: ${config.color}">
                                <div class="kpi-value">${kpi.value}</div>
                                <div class="kpi-label">${kpi.label}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="layer-entities-section">
                        <h2 class="layer-entities-title">All Items</h2>
                        <div class="layer-entities-list">
                            ${config.items.map(item => `
                                <div class="layer-entity-item" data-id="${item.id}" data-type="${item.type}" data-layer="${item.layer}">
                                    <span class="layer-entity-badge ${item.layer}">${getTypeLabel(item.type)}</span>
                                    <span class="layer-entity-name">${item.name}</span>
                                    <span class="layer-entity-status ${item.status}">${item.status}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            // Attach click listeners for entity items
            container.querySelectorAll('.layer-entity-item').forEach(item => {
                item.addEventListener('click', () => {
                    const id = item.dataset.id;
                    selectItem(id);
                });
            });
        }

        function renderStatisticsCard(item) {
            const kpis = getEntityKPIs(item);
            if (!kpis || kpis.length === 0) return '';

            return `
                <div class="card">
                    <div class="card-header" data-card="statistics" aria-expanded="true">
                        <span class="card-title">Statistiken</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        <div class="project-stats-grid">
                            ${kpis.map(kpi => `
                                <div class="project-stat-item">
                                    <span class="project-stat-value">${kpi.value}</span>
                                    <span class="project-stat-label">${kpi.label}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function getEntityKPIs(item) {
            switch (item.type) {
                case 'domain':
                    return []; // No KPI cards for domains
                case 'concept':
                    return []; // No KPI cards for concepts
                case 'entity':
                    const attributes = item.attributes || [];
                    const physicalTables = item.physicalTables || [];
                    return [
                        { label: 'Attributes', value: attributes.length },
                        { label: 'Physical Tables', value: physicalTables.length }
                    ];
                case 'system':
                    const tablesInSystem = data.tables.filter(t => t.system === item.id);
                    const columnsInSystem = tablesInSystem.reduce((sum, t) => sum + (t.columns?.length || 0), 0);
                    return [
                        { label: 'Tabellen', value: tablesInSystem.length },
                        { label: 'Spalten', value: columnsInSystem }
                    ];
                case 'table':
                    const columns = item.columns || [];
                    return [
                        { label: 'Columns', value: columns.length },
                        { label: 'Rows', value: item.rowCount?.toLocaleString() || '' }
                    ];
                default:
                    return [];
            }
        }

        function renderContent() {
            const contentArea = document.getElementById('contentArea');
            if (!contentArea) return;

            // Show projects overview when on root route
            if (state.showProjectsOverview) {
                renderBreadcrumb(null);
                renderProjectsOverview();
                return;
            }

            // Show layer overview when layer is selected but no specific item
            if (!state.selectedItem && !state.currentProject && state.currentLayer) {
                renderBreadcrumb(null);
                renderLayerOverview(state.currentLayer);
                return;
            }

            // If we have a project selected but no specific item, show the project detail
            if (!state.selectedItem && state.currentProject) {
                state.selectedItem = state.currentProject;
            }

            const item = state.selectedItem;

            if (!item) {
                renderBreadcrumb(null);
                document.getElementById('contentBody').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon" aria-hidden="true">${icons.database}</div>
                        <h2 class="empty-state-title">Element auswhlen</h2>
                        <p>Whlen Sie ein Element aus der Navigation, um dessen Details anzuzeigen</p>
                    </div>
                `;
                return;
            }

            renderBreadcrumb(item);

            const container = document.getElementById('contentBody');

            // Project-specific view with Details, Users, Settings tabs
            if (item.type === 'project') {
                container.innerHTML = `
                    <div class="entity-header">
                        <h1 class="entity-title">${item.name}</h1>
                        <p class="entity-subtitle">${item.description || ''}</p>
                        <div class="entity-meta">
                            <span class="entity-meta-item">
                                <span class="status-indicator">
                                    <span class="status-dot ${item.status}" aria-hidden="true"></span>
                                    ${item.status?.charAt(0).toUpperCase() + item.status?.slice(1) || 'Unknown'}
                                </span>
                            </span>
                            ${item.created ? `<span class="entity-meta-item">Created: ${item.created}</span>` : ''}
                            ${item.owner ? `<span class="entity-meta-item">Owner: ${item.owner}</span>` : ''}
                        </div>
                    </div>

                    <div class="view-tabs" role="tablist">
                        <button class="view-tab ${state.projectView === 'details' ? 'active' : ''}" data-project-view="details" role="tab" aria-selected="${state.projectView === 'details'}">Details</button>
                        <button class="view-tab ${state.projectView === 'users' ? 'active' : ''}" data-project-view="users" role="tab" aria-selected="${state.projectView === 'users'}">Benutzer</button>
                        <button class="view-tab ${state.projectView === 'settings' ? 'active' : ''}" data-project-view="settings" role="tab" aria-selected="${state.projectView === 'settings'}">Einstellungen</button>
                    </div>

                    <div class="view-content" role="tabpanel">
                        ${renderProjectTabContent(item)}
                    </div>
                `;
                attachProjectTabListeners();
                return;
            }

            container.innerHTML = `
                <div class="entity-header">
                    <div class="entity-badges">
                        <span class="badge badge-layer ${item.layer}">${getTypeLabel(item.type)}</span>
                    </div>
                    <h1 class="entity-title">${item.name}</h1>
                    <p class="entity-subtitle">${item.description || ''}</p>
                </div>

                <div class="view-content" role="tabpanel">
                    ${state.currentView === 'wiki' ? renderWikiView(item) : renderPlaceholderView(state.currentView)}
                </div>
            `;

            attachContentListeners();
        }

        function renderWikiView(item) {
            let html = '';

            // Statistics Card (first card)
            html += renderStatisticsCard(item);

            // Basic Information Card
            html += `
                <div class="card">
                    <div class="card-header" data-card="basic" aria-expanded="true">
                        <span class="card-title">Grundinformationen</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        <div class="meta-grid">
                            <span class="meta-label">Name (DE)</span>
                            <span class="meta-value">${item.nameDE || item.name}</span>
                            ${item.nameEn ? `
                                <span class="meta-label">Name (EN)</span>
                                <span class="meta-value">${item.nameEn}</span>
                            ` : ''}
                            ${item.nameFr ? `
                                <span class="meta-label">Name (FR)</span>
                                <span class="meta-value">${item.nameFr}</span>
                            ` : ''}
                            <span class="meta-label">Beschreibung</span>
                            <span class="meta-value">${item.description || ''}</span>
                            ${item.synonyms ? `
                                <span class="meta-label">Synonyme</span>
                                <span class="meta-value">${item.synonyms.map(s => `<span class="tag">${s}</span>`).join('')}</span>
                            ` : ''}
                            ${item.owner ? `
                                <span class="meta-label">Verantwortlich</span>
                                <span class="meta-value">${item.owner}</span>
                            ` : ''}
                            ${item.technology ? `
                                <span class="meta-label">Technologie</span>
                                <span class="meta-value"><span class="tag tag-mono">${item.technology}</span></span>
                            ` : ''}
                            ${item.rowCount ? `
                                <span class="meta-label">Zeilenanzahl</span>
                                <span class="meta-value">${item.rowCount.toLocaleString()}</span>
                            ` : ''}
                            ${item.status ? `
                                <span class="meta-label">Status</span>
                                <span class="meta-value">
                                    <span class="status-indicator">
                                        <span class="status-dot ${item.status}" aria-hidden="true"></span>
                                        ${item.status.charAt(0).toUpperCase() + item.status.slice(1)}
                                    </span>
                                </span>
                            ` : ''}
                            ${item.created ? `
                                <span class="meta-label">Erstellt</span>
                                <span class="meta-value">${item.created}</span>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;

            // Concepts Panel (for domains only)
            if (item.type === 'domain') {
                const domainConcepts = data.concepts.filter(c => c.domain === item.id);
                html += `
                    <div class="card">
                        <div class="card-header" data-card="concepts" aria-expanded="true">
                            <span class="card-title">Konzepte (${domainConcepts.length})</span>
                            <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                        </div>
                        <div class="card-content" style="padding: 0;">
                            ${domainConcepts.length > 0 ? `
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Beschreibung</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${domainConcepts.map(concept => `
                                            <tr class="clickable-row" data-id="${concept.id}">
                                                <td><strong>${concept.name}</strong></td>
                                                <td>${concept.description || ''}</td>
                                                <td><span class="badge badge-outline">${concept.status || 'active'}</span></td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            ` : '<div class="empty-list-message">Keine Konzepte in dieser Domne</div>'}
                        </div>
                    </div>
                `;
            }

            // Compliance Panel (for entities only)
            if (item.type === 'entity') {
                html += `
                    <div class="card">
                        <div class="card-header" data-card="compliance" aria-expanded="true">
                            <span class="card-title">Compliance & Recht</span>
                            <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                        </div>
                        <div class="card-content">
                            <div class="meta-grid">
                                ${item.legalRefs && item.legalRefs.length ? `
                                    <span class="meta-label">Rechtliche Grundlagen</span>
                                    <span class="meta-value">${item.legalRefs.map(r => `<span class="tag">${r}</span>`).join('')}</span>
                                ` : ''}
                                ${item.standards && item.standards.length ? `
                                    <span class="meta-label">Standards</span>
                                    <span class="meta-value">${item.standards.map(s => `<span class="tag tag-mono">${s}</span>`).join('')}</span>
                                ` : ''}
                                <span class="meta-label">Klassifikation</span>
                                <span class="meta-value">
                                    <span class="badge badge-outline badge-compliance internal">Internal</span>
                                </span>
                                <span class="meta-label">Personendaten</span>
                                <span class="meta-value">No</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Attributes Panel (for entities and tables)
            if (item.attributes || item.columns) {
                const attrs = item.attributes || item.columns;
                html += `
                    <div class="card">
                        <div class="card-header" data-card="attributes" aria-expanded="true">
                            <span class="card-title">${item.attributes ? 'Attributes' : 'Columns'} (${attrs.length})</span>
                            <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                        </div>
                        <div class="card-content" style="padding: 0;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Nullable</th>
                                        <th>Key</th>
                                        ${item.columns ? '<th>Maps To</th>' : ''}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${attrs.map(attr => `
                                        <tr>
                                            <td><code>${attr.name}</code></td>
                                            <td><span class="type-label">${attr.type}</span></td>
                                            <td>${attr.nullable ? 'Yes' : 'No'}</td>
                                            <td>${attr.key ? `<span class="key-badge ${attr.key.toLowerCase()}">${attr.key}</span>` : ''}</td>
                                            ${item.columns ? `<td>${attr.mappedTo ? `<code>${attr.mappedTo}</code>` : ''}</td>` : ''}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // Cross-Layer Mappings
            html += renderMappingsPanel(item);

            return html;
        }

        function renderMappingsPanel(item) {
            const mappings = { conceptual: [], logical: [], physical: [] };

            if (item.type === 'concept') {
                const entities = data.entities.filter(e => e.concept === item.id);
                mappings.logical = entities;
                entities.forEach(e => {
                    e.physicalTables?.forEach(tId => {
                        const table = findItemById(tId);
                        if (table) mappings.physical.push(table);
                    });
                });
            } else if (item.type === 'entity') {
                if (item.concept) {
                    const concept = findItemById(item.concept);
                    if (concept) mappings.conceptual.push(concept);
                }
                item.physicalTables?.forEach(tId => {
                    const table = findItemById(tId);
                    if (table) mappings.physical.push(table);
                });
            } else if (item.type === 'table') {
                if (item.logicalEntity) {
                    const entity = findItemById(item.logicalEntity);
                    if (entity) {
                        mappings.logical.push(entity);
                        if (entity.concept) {
                            const concept = findItemById(entity.concept);
                            if (concept) mappings.conceptual.push(concept);
                        }
                    }
                }
            }

            const hasMappings = mappings.conceptual.length || mappings.logical.length || mappings.physical.length;
            if (!hasMappings) return '';

            return `
                <div class="card">
                    <div class="card-header" data-card="mappings" aria-expanded="true">
                        <span class="card-title">Schichtbergreifende Zuordnungen</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        ${mappings.conceptual.length ? `
                            <div class="mapping-section">
                                <div class="mapping-section-header">Konzeptuelle Schicht</div>
                                ${mappings.conceptual.map(m => renderMappingCard(m)).join('')}
                            </div>
                        ` : ''}
                        ${mappings.logical.length ? `
                            <div class="mapping-section">
                                <div class="mapping-section-header">Logische Schicht</div>
                                ${mappings.logical.map(m => renderMappingCard(m)).join('')}
                            </div>
                        ` : ''}
                        ${mappings.physical.length ? `
                            <div class="mapping-section">
                                <div class="mapping-section-header">Physische Schicht</div>
                                ${mappings.physical.map(m => renderMappingCard(m)).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderMappingCard(item) {
            return `
                <div class="mapping-card ${item.layer}" data-id="${item.id}" tabindex="0" role="button">
                    <div class="mapping-icon ${item.layer}">${getTypeIcon(item.type)}</div>
                    <div class="mapping-info">
                        <div class="mapping-title">${item.name}</div>
                        <div class="mapping-subtitle">${getTypeLabel(item.type)}</div>
                    </div>
                    <span class="mapping-arrow" aria-hidden="true">${icons.arrowRight}</span>
                </div>
            `;
        }

        // Project Tab Content Rendering
        function renderProjectTabContent(project) {
            switch (state.projectView) {
                case 'details':
                    return renderProjectDetailsTab(project);
                case 'users':
                    return renderProjectUsersTab(project);
                case 'settings':
                    return renderProjectSettingsTab(project);
                default:
                    return renderProjectDetailsTab(project);
            }
        }

        function renderProjectDetailsTab(project) {
            // Count entities in this project
            const projectDomains = data.domains.filter(d => project.domains?.includes(d.id));
            const projectConcepts = data.concepts.filter(c => projectDomains.some(d => c.domain === d.id));
            const projectEntities = data.entities.filter(e => projectDomains.some(d => e.domain === d.id));
            const projectSystems = data.systems || [];
            const projectTables = data.tables || [];

            return `
                <div class="card">
                    <div class="card-header" data-card="statistics" aria-expanded="true">
                        <span class="card-title">Statistiken</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        <div class="project-stats-grid">
                            <div class="project-stat-item">
                                <span class="project-stat-icon">${icons.folder}</span>
                                <div class="project-stat-content">
                                    <span class="project-stat-value">${projectDomains.length}</span>
                                    <span class="project-stat-label">Domnen</span>
                                </div>
                            </div>
                            <div class="project-stat-item">
                                <span class="project-stat-icon">${icons.lightbulb}</span>
                                <div class="project-stat-content">
                                    <span class="project-stat-value">${projectConcepts.length}</span>
                                    <span class="project-stat-label">Konzepte</span>
                                </div>
                            </div>
                            <div class="project-stat-item">
                                <span class="project-stat-icon">${icons.cube}</span>
                                <div class="project-stat-content">
                                    <span class="project-stat-value">${projectEntities.length}</span>
                                    <span class="project-stat-label">Entitten</span>
                                </div>
                            </div>
                            <div class="project-stat-item">
                                <span class="project-stat-icon">${icons.server}</span>
                                <div class="project-stat-content">
                                    <span class="project-stat-value">${projectSystems.length}</span>
                                    <span class="project-stat-label">Systeme</span>
                                </div>
                            </div>
                            <div class="project-stat-item">
                                <span class="project-stat-icon">${icons.table}</span>
                                <div class="project-stat-content">
                                    <span class="project-stat-value">${projectTables.length}</span>
                                    <span class="project-stat-label">Tabellen</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" data-card="overview" aria-expanded="true">
                        <span class="card-title">Projektbersicht</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        <div class="meta-grid">
                            <span class="meta-label">Name (DE)</span>
                            <span class="meta-value">${project.nameDE || project.name}</span>
                            <span class="meta-label">Beschreibung</span>
                            <span class="meta-value">${project.description || ''}</span>
                            <span class="meta-label">Verantwortlich</span>
                            <span class="meta-value">${project.owner || ''}</span>
                            <span class="meta-label">Erstellt</span>
                            <span class="meta-value">${project.created || ''}</span>
                            <span class="meta-label">Status</span>
                            <span class="meta-value">
                                <span class="badge badge-outline">${project.status || 'Aktiv'}</span>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" data-card="domains" aria-expanded="true">
                        <span class="card-title">Domains (${projectDomains.length})</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content" style="padding: 0;">
                        ${projectDomains.length > 0 ? `
                            <div class="project-domains-list">
                                ${projectDomains.map(d => `
                                    <div class="project-domain-item" data-id="${d.id}">
                                        <span class="domain-name">${d.name}</span>
                                        <span class="domain-desc text-secondary">${d.description || ''}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<div class="empty-list-message">No domains assigned to this project</div>'}
                    </div>
                </div>
            `;
        }

        function renderProjectUsersTab(project) {
            // Mock user data for the project
            const users = [
                { name: 'Anna Mller', role: 'Project Owner', email: 'anna.mueller@admin.ch', avatar: 'AM' },
                { name: 'Peter Schmidt', role: 'Data Steward', email: 'peter.schmidt@admin.ch', avatar: 'PS' },
                { name: 'Lisa Weber', role: 'Data Engineer', email: 'lisa.weber@admin.ch', avatar: 'LW' },
                { name: 'Thomas Brunner', role: 'Business Analyst', email: 'thomas.brunner@admin.ch', avatar: 'TB' },
                { name: 'Sarah Keller', role: 'Viewer', email: 'sarah.keller@admin.ch', avatar: 'SK' }
            ];

            return `
                <div class="card">
                    <div class="card-header" data-card="team" aria-expanded="true">
                        <span class="card-title">Team Members (${users.length})</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content" style="padding: 0;">
                        <div class="users-list">
                            ${users.map(user => `
                                <div class="user-item">
                                    <div class="user-avatar">${user.avatar}</div>
                                    <div class="user-info">
                                        <span class="user-name">${user.name}</span>
                                        <span class="user-email text-secondary">${user.email}</span>
                                    </div>
                                    <span class="user-role badge badge-outline">${user.role}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" data-card="roles" aria-expanded="true">
                        <span class="card-title">Role Definitions</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        <div class="roles-list">
                            <div class="role-item">
                                <span class="role-name">Project Owner</span>
                                <span class="role-desc text-secondary">Full administrative access, can manage users and settings</span>
                            </div>
                            <div class="role-item">
                                <span class="role-name">Data Steward</span>
                                <span class="role-desc text-secondary">Can create, edit and approve metadata entries</span>
                            </div>
                            <div class="role-item">
                                <span class="role-name">Data Engineer</span>
                                <span class="role-desc text-secondary">Can manage physical layer entities and mappings</span>
                            </div>
                            <div class="role-item">
                                <span class="role-name">Business Analyst</span>
                                <span class="role-desc text-secondary">Can create and edit conceptual layer entries</span>
                            </div>
                            <div class="role-item">
                                <span class="role-name">Viewer</span>
                                <span class="role-desc text-secondary">Read-only access to all project data</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProjectSettingsTab(project) {
            return `
                <div class="card">
                    <div class="card-header" data-card="general" aria-expanded="true">
                        <span class="card-title">General Settings</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        <div class="settings-form">
                            <div class="setting-row">
                                <label class="setting-label">Project Name</label>
                                <input type="text" class="setting-input" value="${project.name}" readonly />
                            </div>
                            <div class="setting-row">
                                <label class="setting-label">Project ID</label>
                                <input type="text" class="setting-input" value="${project.id}" readonly />
                            </div>
                            <div class="setting-row">
                                <label class="setting-label">Default Language</label>
                                <select class="setting-select" disabled>
                                    <option value="de" selected>German (DE)</option>
                                    <option value="en">English (EN)</option>
                                    <option value="fr">French (FR)</option>
                                    <option value="it">Italian (IT)</option>
                                </select>
                            </div>
                            <div class="setting-row">
                                <label class="setting-label">Visibility</label>
                                <select class="setting-select" disabled>
                                    <option value="internal" selected>Internal (Federal)</option>
                                    <option value="public">Public</option>
                                    <option value="restricted">Restricted</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" data-card="notifications" aria-expanded="true">
                        <span class="card-title">Notifications</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        <div class="settings-form">
                            <div class="setting-row setting-toggle-row">
                                <div class="setting-toggle-info">
                                    <span class="setting-label">Email Notifications</span>
                                    <span class="setting-desc text-secondary">Receive email updates on changes</span>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" checked disabled />
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-row setting-toggle-row">
                                <div class="setting-toggle-info">
                                    <span class="setting-label">Weekly Digest</span>
                                    <span class="setting-desc text-secondary">Summary of all changes in the past week</span>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" disabled />
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-row setting-toggle-row">
                                <div class="setting-toggle-info">
                                    <span class="setting-label">Approval Requests</span>
                                    <span class="setting-desc text-secondary">Notify when items need approval</span>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" checked disabled />
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" data-card="danger" aria-expanded="true">
                        <span class="card-title">Danger Zone</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        <div class="danger-zone">
                            <div class="danger-item">
                                <div class="danger-info">
                                    <span class="danger-title">Archive Project</span>
                                    <span class="danger-desc text-secondary">Move this project to archive. Can be restored later.</span>
                                </div>
                                <button class="btn btn-outline-danger" disabled>Archive</button>
                            </div>
                            <div class="danger-item">
                                <div class="danger-info">
                                    <span class="danger-title">Delete Project</span>
                                    <span class="danger-desc text-secondary">Permanently delete this project and all its data.</span>
                                </div>
                                <button class="btn btn-danger" disabled>Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function attachProjectTabListeners() {
            document.querySelectorAll('[data-project-view]').forEach(tab => {
                tab.addEventListener('click', () => {
                    state.projectView = tab.dataset.projectView;
                    renderContent();
                });
            });

            // Card toggle functionality
            document.querySelectorAll('.card-header[data-card]').forEach(header => {
                header.addEventListener('click', () => {
                    const card = header.closest('.card');
                    const content = card.querySelector('.card-content');
                    const isExpanded = header.getAttribute('aria-expanded') === 'true';
                    header.setAttribute('aria-expanded', !isExpanded);
                    content.style.display = isExpanded ? 'none' : 'block';
                });
            });

            // Domain item click handler
            document.querySelectorAll('.project-domain-item[data-id]').forEach(item => {
                item.addEventListener('click', () => {
                    const domain = findItemById(item.dataset.id);
                    if (domain) {
                        selectItem(domain);
                    }
                });
            });
        }

        function renderPlaceholderView(view) {
            const viewInfo = {
                diagram: { icon: icons.box, title: 'Entity Diagram', desc: 'Visual entity-relationship diagram' },
                lineage: { icon: icons.arrowRight, title: 'Data Lineage', desc: 'Source to target data flow' },
                history: { icon: icons.hash, title: 'Version History', desc: 'Changelog and versioning' }
            };
            const info = viewInfo[view] || { icon: '?', title: view, desc: '' };
            return `
                <div class="placeholder-view">
                    <div class="placeholder-icon" aria-hidden="true">${info.icon}</div>
                    <h3 class="placeholder-title">${info.title}</h3>
                    <p class="placeholder-desc">${info.desc}</p>
                    <p style="margin-top: var(--space-4); opacity: 0.5; font-size: var(--text-caption);">Coming soon in future release</p>
                </div>
            `;
        }

        function renderSearchResults() {
            const container = document.getElementById('searchResults');
            if (!container) return;

            if (!state.searchResults.length) {
                container.classList.remove('active');
                return;
            }

            container.innerHTML = `
                <div class="search-results-header">${state.searchResults.length} results</div>
                ${state.searchResults.map(item => `
                    <div class="search-result-item ${item.layer}" data-id="${item.id}" role="option" tabindex="0">
                        <span class="tree-icon ${item.layer}">${getTypeIcon(item.type)}</span>
                        <div class="search-result-info">
                            <div class="search-result-name">${item.name}</div>
                            <div class="search-result-meta">${getTypeLabel(item.type)}  ${item.layer}</div>
                        </div>
                    </div>
                `).join('')}
            `;

            container.classList.add('active');

            container.querySelectorAll('.search-result-item').forEach(el => {
                el.addEventListener('click', () => {
                    selectItem(el.dataset.id);
                    document.getElementById('searchInput').value = '';
                    state.searchResults = [];
                    container.classList.remove('active');
                });
            });
        }

        // ========================================
        // Event Handlers
        // ========================================
        function selectItem(id) {
            const item = findItemById(id);
            if (item) {
                state.selectedItem = item;
                state.currentView = 'wiki';
                if (item.layer !== state.currentLayer) {
                    state.currentLayer = item.layer;
                }
                expandParents(item);
                navigateTo(`/${item.layer}/${item.type}/${item.id}`);
            }
        }

        function toggleNode(id) {
            if (state.expandedNodes.has(id)) {
                state.expandedNodes.delete(id);
            } else {
                state.expandedNodes.add(id);
            }
            renderTree();
        }

        function updateLayerTabs() {
            document.querySelectorAll('.layer-tab').forEach(tab => {
                const isActive = tab.dataset.layer === state.currentLayer;
                tab.classList.toggle('active', isActive);
                tab.setAttribute('aria-selected', isActive);
            });
        }

        function attachTreeListeners() {
            document.querySelectorAll('.tree-node').forEach(node => {
                node.addEventListener('click', (e) => {
                    const id = node.dataset.id;

                    // Handle attribute clicks - select the parent entity
                    if (node.classList.contains('attribute-node')) {
                        const entityId = node.dataset.entity;
                        if (entityId) {
                            selectItem(entityId);
                        }
                        return;
                    }

                    // Handle column clicks - do nothing
                    if (node.classList.contains('column-node')) {
                        return;
                    }

                    if (e.target.closest('.tree-toggle')) {
                        toggleNode(id);
                    } else {
                        selectItem(id);
                    }
                });

                node.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        // Handle attribute keydown - select the parent entity
                        if (node.classList.contains('attribute-node')) {
                            const entityId = node.dataset.entity;
                            if (entityId) {
                                selectItem(entityId);
                            }
                            return;
                        }
                        // Handle column keydown - do nothing
                        if (node.classList.contains('column-node')) {
                            return;
                        }
                        selectItem(node.dataset.id);
                    } else if (e.key === 'ArrowRight') {
                        state.expandedNodes.add(node.dataset.id);
                        renderTree();
                    } else if (e.key === 'ArrowLeft') {
                        state.expandedNodes.delete(node.dataset.id);
                        renderTree();
                    }
                });
            });
        }

        function attachContentListeners() {
            // Card toggles
            document.querySelectorAll('.card-header').forEach(header => {
                header.addEventListener('click', () => {
                    const card = header.closest('.card');
                    card.classList.toggle('collapsed');
                    header.setAttribute('aria-expanded', !card.classList.contains('collapsed'));
                });
            });

            // Mapping cards
            document.querySelectorAll('.mapping-card').forEach(card => {
                card.addEventListener('click', () => selectItem(card.dataset.id));
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectItem(card.dataset.id);
                    }
                });
            });

            // Clickable table rows
            document.querySelectorAll('.clickable-row').forEach(row => {
                row.addEventListener('click', () => {
                    const itemId = row.dataset.id;
                    if (itemId) {
                        const item = findItemById(itemId);
                        if (item) selectItem(item);
                    }
                });
            });
        }

        // ========================================
        // Keyboard Shortcuts
        // ========================================
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // "/" to focus search
                if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
                    const searchInput = document.getElementById('searchInput');
                    if (document.activeElement !== searchInput) {
                        e.preventDefault();
                        searchInput?.focus();
                    }
                }

                // "[" to collapse sidebar
                if (e.key === '[' && !e.ctrlKey && !e.metaKey) {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar && !state.sidebarCollapsed) {
                        state.sidebarCollapsed = true;
                        sidebar.classList.add('collapsed');
                    }
                }

                // "]" to expand sidebar
                if (e.key === ']' && !e.ctrlKey && !e.metaKey) {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar && state.sidebarCollapsed) {
                        state.sidebarCollapsed = false;
                        sidebar.classList.remove('collapsed');
                    }
                }

                // Escape to close search
                if (e.key === 'Escape') {
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults?.classList.contains('active')) {
                        searchResults.classList.remove('active');
                        document.getElementById('searchInput').blur();
                    }
                }
            });
        }

        // ========================================
        // Initialization
        // ========================================
        async function init() {
            const loaded = await loadData();

            if (!loaded) {
                document.getElementById('app').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">${icons.database}</div>
                        <h2 class="empty-state-title">Failed to load data</h2>
                        <p>Please check if data files exist in /data folder.</p>
                    </div>
                `;
                return;
            }

            renderApp();
            setupKeyboardShortcuts();
            attachSubHeaderListeners();

            // Layer tabs
            document.querySelectorAll('.layer-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    state.currentLayer = tab.dataset.layer;
                    state.selectedItem = null;
                    state.currentView = 'wiki';
                    navigateTo(`/${state.currentLayer}`);
                });
            });

            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', () => {
                state.theme = state.theme === 'light' ? 'dark' : 'light';
                document.documentElement.dataset.theme = state.theme;
                document.getElementById('themeToggle').innerHTML = state.theme === 'light' ? icons.sun : icons.moon;
            });

            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', () => {
                state.sidebarCollapsed = !state.sidebarCollapsed;
                document.getElementById('sidebar').classList.toggle('collapsed', state.sidebarCollapsed);
            });

            // Sidebar overlay (mobile)
            document.getElementById('sidebarOverlay')?.addEventListener('click', () => {
                state.sidebarCollapsed = true;
                document.getElementById('sidebar').classList.add('collapsed');
            });

            // Expanding Search
            const searchContainer = document.querySelector('.search-container');
            const searchToggle = document.getElementById('searchToggle');
            const searchInput = document.getElementById('searchInput');

            searchToggle.addEventListener('click', () => {
                searchContainer.classList.add('expanded');
                setTimeout(() => searchInput.focus(), 50);
            });

            searchInput.addEventListener('input', (e) => handleSearch(e.target.value));
            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    document.getElementById('searchResults')?.classList.remove('active');
                    // Collapse if empty
                    if (!searchInput.value) {
                        searchContainer.classList.remove('expanded');
                    }
                }, 200);
            });

            // Close search on Escape
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    searchInput.value = '';
                    searchInput.blur();
                    searchContainer.classList.remove('expanded');
                    handleSearch('');
                }
            });

            // Group-by dropdown
            const groupByDropdown = document.getElementById('groupByDropdown');
            const groupByTrigger = document.getElementById('groupByTrigger');
            const groupByMenu = document.getElementById('groupByMenu');

            groupByTrigger.addEventListener('click', () => {
                groupByDropdown.classList.toggle('open');
                groupByTrigger.setAttribute('aria-expanded', groupByDropdown.classList.contains('open'));
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!groupByDropdown.contains(e.target)) {
                    groupByDropdown.classList.remove('open');
                    groupByTrigger.setAttribute('aria-expanded', 'false');
                }
            });

            // Handle option selection
            groupByMenu.querySelectorAll('.group-by-option').forEach(option => {
                option.addEventListener('click', () => {
                    const value = option.dataset.value;
                    const text = option.querySelector('span:last-child').textContent;
                    const iconHtml = option.querySelector('.group-by-option-icon').innerHTML;

                    // Update trigger text and icon
                    groupByTrigger.querySelector('.group-by-trigger-text').textContent = text;
                    groupByTrigger.querySelector('.group-by-trigger-icon').innerHTML = iconHtml;

                    // Update selected state
                    groupByMenu.querySelectorAll('.group-by-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');

                    // Close dropdown
                    groupByDropdown.classList.remove('open');
                    groupByTrigger.setAttribute('aria-expanded', 'false');

                    // Update state and re-render tree
                    state.groupBy = value;
                    renderTree();
                });
            });

            // Handle URL routing
            window.addEventListener('hashchange', handleRoute);
            handleRoute();

            // If no specific route, show projects overview (landing page)
            if (!state.selectedItem && !state.currentProject) {
                renderProjectsOverview();
            }
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
