<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta-Atlas | Metadata Catalog</title>
    <style>
        /* ========================================
           CSS Variables & Design Tokens
           Based on DESIGNGUIDE.md specifications
           ======================================== */
        :root {
            /* ===== Color System - Slate Scale ===== */

            /* Dark Mode (Primary) - Slate Scale */
            --color-bg-base: #0F172A;
            --color-bg-surface: #1E293B;
            --color-bg-elevated: #334155;
            --color-bg-hover: #475569;

            --color-text-primary: #F1F5F9;
            --color-text-secondary: #94A3B8;
            --color-text-muted: #64748B;

            --color-border-default: #334155;
            --color-border-subtle: #1E293B;

            /* Layer Colors - Dark Mode */
            --color-conceptual: #60A5FA;
            --color-conceptual-bg: #1E3A5F;
            --color-conceptual-border: #3B82F6;

            --color-logical: #34D399;
            --color-logical-bg: #064E3B;
            --color-logical-border: #10B981;

            --color-physical: #FBBF24;
            --color-physical-bg: #451A03;
            --color-physical-border: #F59E0B;

            /* Status Colors */
            --color-status-active: #10B981;
            --color-status-draft: #F59E0B;
            --color-status-deprecated: #64748B;
            --color-status-planned: #8B5CF6;

            /* Semantic Colors */
            --color-error: #EF4444;
            --color-warning: #F59E0B;
            --color-success: #10B981;
            --color-info: #3B82F6;

            /* Compliance Badge Colors */
            --color-public: #10B981;
            --color-internal: #3B82F6;
            --color-confidential: #F59E0B;
            --color-secret: #EF4444;
            --color-personal-data: #8B5CF6;

            /* Swiss Accent (critical actions only) */
            --color-swiss-red: #DC2626;

            /* ===== Typography ===== */
            --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SF Mono", SFMono-Regular, Consolas, "Liberation Mono", Menlo, Monaco, monospace;

            /* Type Scale */
            --text-display: 2rem;      /* 32px */
            --text-h1: 1.5rem;         /* 24px */
            --text-h2: 1.25rem;        /* 20px */
            --text-h3: 1rem;           /* 16px */
            --text-body: 1rem;         /* 16px */
            --text-small: 0.875rem;    /* 14px */
            --text-caption: 0.75rem;   /* 12px */

            /* Line Heights */
            --leading-display: 1.2;
            --leading-h1: 1.3;
            --leading-h2: 1.35;
            --leading-h3: 1.4;
            --leading-body: 1.6;
            --leading-small: 1.5;
            --leading-caption: 1.4;

            /* Font Weights */
            --font-normal: 400;
            --font-medium: 500;
            --font-semibold: 600;

            /* ===== Spacing Scale (4px base) ===== */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            --space-10: 40px;
            --space-12: 48px;

            /* ===== Layout Dimensions ===== */
            --sidebar-width: 280px;
            --sidebar-min-width: 200px;
            --sidebar-max-width: 400px;
            --sidebar-collapsed-width: 56px;
            --header-height: 56px;
            --content-max-width: 1200px;
            --prose-max-width: 720px;

            /* ===== Border Radius ===== */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --radius-xl: 12px;
            --radius-full: 9999px;

            /* ===== Shadows - Dark Mode ===== */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);

            /* ===== Animation ===== */
            --duration-fast: 100ms;
            --duration-normal: 200ms;
            --duration-slow: 300ms;
            --ease-out: cubic-bezier(0, 0, 0.2, 1);
            --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);

            /* ===== Breakpoints ===== */
            --breakpoint-sm: 640px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 1024px;
            --breakpoint-xl: 1440px;
        }

        /* ===== Light Theme ===== */
        [data-theme="light"] {
            --color-bg-base: #FFFFFF;
            --color-bg-surface: #F8FAFC;
            --color-bg-elevated: #FFFFFF;
            --color-bg-hover: #F1F5F9;

            --color-text-primary: #1E293B;
            --color-text-secondary: #64748B;
            --color-text-muted: #94A3B8;

            --color-border-default: #E2E8F0;
            --color-border-subtle: #F1F5F9;

            /* Layer Colors - Light Mode */
            --color-conceptual: #3B82F6;
            --color-conceptual-bg: #DBEAFE;
            --color-conceptual-border: #3B82F6;

            --color-logical: #10B981;
            --color-logical-bg: #D1FAE5;
            --color-logical-border: #10B981;

            --color-physical: #F59E0B;
            --color-physical-bg: #FEF3C7;
            --color-physical-border: #F59E0B;

            /* Shadows - Light Mode */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* ===== Reduced Motion ===== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ========================================
           Base Styles
           ======================================== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-sans);
            font-size: var(--text-body);
            line-height: var(--leading-body);
            background-color: var(--color-bg-base);
            color: var(--color-text-primary);
            overflow: hidden;
        }

        /* ===== Focus States ===== */
        :focus {
            outline: none;
        }

        :focus-visible {
            outline: 2px solid var(--color-conceptual);
            outline-offset: 2px;
        }

        /* ===== Skip Link ===== */
        .skip-link {
            position: absolute;
            top: -100%;
            left: var(--space-4);
            padding: var(--space-2) var(--space-4);
            background: var(--color-bg-elevated);
            color: var(--color-text-primary);
            border-radius: var(--radius-md);
            z-index: 1000;
            transition: top var(--duration-fast) var(--ease-out);
        }

        .skip-link:focus {
            top: var(--space-4);
        }

        /* ========================================
           Layout
           ======================================== */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .main-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ===== Loading State ===== */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            flex-direction: column;
            gap: var(--space-4);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--color-border-default);
            border-top-color: var(--color-logical);
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========================================
           Header
           ======================================== */
        .header {
            height: var(--header-height);
            background-color: var(--color-bg-surface);
            border-bottom: 1px solid var(--color-border-default);
            display: flex;
            align-items: center;
            padding: 0 var(--space-4);
            gap: var(--space-6);
            position: relative;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--text-h2);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            letter-spacing: -0.01em;
            text-decoration: none;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--color-conceptual), var(--color-logical), var(--color-physical));
            border-radius: var(--radius-md);
            flex-shrink: 0;
        }

        /* ===== Layer Tabs ===== */
        .layer-tabs {
            display: flex;
            gap: 2px;
            background: var(--color-bg-base);
            padding: 3px;
            border-radius: var(--radius-md);
        }

        .layer-tab {
            padding: var(--space-2) var(--space-4);
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-family: var(--font-sans);
            font-size: var(--text-small);
            font-weight: var(--font-medium);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .layer-tab:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-hover);
        }

        .layer-tab.active {
            color: white;
            font-weight: var(--font-semibold);
        }

        .layer-tab[data-layer="conceptual"].active {
            background: var(--color-conceptual);
        }

        .layer-tab[data-layer="logical"].active {
            background: var(--color-logical);
            color: var(--color-bg-base);
        }

        .layer-tab[data-layer="physical"].active {
            background: var(--color-physical);
            color: var(--color-bg-base);
        }

        /* ===== Search ===== */
        .search-container {
            flex: 1;
            max-width: 400px;
            position: relative;
        }

        .search-wrapper {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: var(--space-2) var(--space-4);
            padding-left: 40px;
            background: var(--color-bg-base);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            color: var(--color-text-primary);
            font-family: var(--font-sans);
            font-size: var(--text-small);
            transition: border-color var(--duration-fast) var(--ease-out),
                        box-shadow var(--duration-fast) var(--ease-out);
        }

        .search-input:focus {
            border-color: var(--color-conceptual);
            box-shadow: 0 0 0 3px var(--color-conceptual-bg);
        }

        .search-input::placeholder {
            color: var(--color-text-muted);
        }

        .search-icon {
            position: absolute;
            left: var(--space-3);
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            pointer-events: none;
        }

        .search-shortcut {
            position: absolute;
            right: var(--space-3);
            top: 50%;
            transform: translateY(-50%);
            padding: 2px 6px;
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: var(--text-caption);
            color: var(--color-text-muted);
        }

        /* ===== Header Right ===== */
        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-left: auto;
        }

        .lang-selector {
            padding: var(--space-1) var(--space-2);
            background: var(--color-bg-base);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-sm);
            color: var(--color-text-primary);
            font-family: var(--font-sans);
            font-size: var(--text-caption);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: border-color var(--duration-fast) var(--ease-out);
        }

        .lang-selector:hover {
            border-color: var(--color-text-muted);
        }

        .icon-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--color-bg-base);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
        }

        .icon-btn:hover {
            background: var(--color-bg-hover);
            color: var(--color-text-primary);
        }

        .icon-btn svg {
            width: 18px;
            height: 18px;
        }

        /* ========================================
           Sidebar
           ======================================== */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-min-width);
            max-width: var(--sidebar-max-width);
            background: var(--color-bg-surface);
            border-right: 1px solid var(--color-border-default);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: width var(--duration-slow) var(--ease-in-out);
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
            min-width: var(--sidebar-collapsed-width);
        }

        .sidebar-header {
            padding: var(--space-4);
            border-bottom: 1px solid var(--color-border-default);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-title {
            font-size: var(--text-caption);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
        }

        .sidebar.collapsed .sidebar-title {
            display: none;
        }

        .sidebar-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .sidebar-toggle:hover {
            background: var(--color-bg-hover);
            color: var(--color-text-primary);
        }

        .sidebar-toggle svg {
            transition: transform var(--duration-fast) var(--ease-out);
        }

        .sidebar.collapsed .sidebar-toggle svg {
            transform: rotate(180deg);
        }

        .tree-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-2);
        }

        /* ===== Tree Navigation ===== */
        .layer-section {
            margin-bottom: var(--space-2);
        }

        .layer-section-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-caption);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--duration-fast) var(--ease-out);
            user-select: none;
        }

        .layer-section-header:hover {
            background: var(--color-bg-hover);
            color: var(--color-text-secondary);
        }

        .layer-section-header .layer-indicator {
            width: 4px;
            height: 16px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .layer-section-header.conceptual .layer-indicator {
            background: var(--color-conceptual);
        }

        .layer-section-header.logical .layer-indicator {
            background: var(--color-logical);
        }

        .layer-section-header.physical .layer-indicator {
            background: var(--color-physical);
        }

        .layer-section-header .layer-toggle {
            margin-left: auto;
            transition: transform var(--duration-fast) var(--ease-out);
        }

        .layer-section-header.collapsed .layer-toggle {
            transform: rotate(-90deg);
        }

        .layer-section-content {
            padding-left: var(--space-1);
        }

        .layer-section-content.collapsed {
            display: none;
        }

        .tree-section {
            margin-bottom: var(--space-4);
        }

        .tree-section-header {
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-caption);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
        }

        .tree-item {
            user-select: none;
        }

        .tree-node {
            display: flex;
            align-items: center;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            cursor: pointer;
            gap: var(--space-2);
            transition: background-color var(--duration-fast) var(--ease-out);
            border-left: 3px solid transparent;
            margin-left: -3px;
        }

        .tree-node:hover {
            background: var(--color-bg-hover);
        }

        .tree-node.selected {
            background: var(--color-bg-elevated);
        }

        .tree-node.selected.conceptual {
            border-left-color: var(--color-conceptual);
        }

        .tree-node.selected.logical {
            border-left-color: var(--color-logical);
        }

        .tree-node.selected.physical {
            border-left-color: var(--color-physical);
        }

        .tree-toggle {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-muted);
            flex-shrink: 0;
            transition: transform var(--duration-fast) var(--ease-out);
        }

        .tree-toggle.expanded {
            transform: rotate(90deg);
        }

        .tree-toggle svg {
            width: 14px;
            height: 14px;
        }

        .tree-icon {
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            font-size: var(--text-caption);
            font-weight: var(--font-semibold);
            flex-shrink: 0;
        }

        .tree-icon.conceptual {
            background: var(--color-conceptual-bg);
            color: var(--color-conceptual);
        }

        .tree-icon.logical {
            background: var(--color-logical-bg);
            color: var(--color-logical);
        }

        .tree-icon.physical {
            background: var(--color-physical-bg);
            color: var(--color-physical);
        }

        .tree-label {
            font-size: var(--text-small);
            color: var(--color-text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .tree-count {
            font-size: var(--text-caption);
            color: var(--color-text-muted);
            padding: 0 var(--space-2);
            background: var(--color-bg-base);
            border-radius: var(--radius-full);
        }

        .tree-children {
            margin-left: var(--space-6);
            display: none;
        }

        .tree-children.expanded {
            display: block;
        }

        /* ========================================
           Main Content
           ======================================== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--color-bg-base);
        }

        /* ===== Breadcrumb ===== */
        .breadcrumb {
            padding: var(--space-3) var(--space-6);
            background: var(--color-bg-surface);
            border-bottom: 1px solid var(--color-border-default);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-small);
            min-height: 44px;
        }

        .breadcrumb-item {
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .breadcrumb-item:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-hover);
        }

        .breadcrumb-separator {
            color: var(--color-text-muted);
        }

        .breadcrumb-current {
            color: var(--color-text-primary);
            font-weight: var(--font-medium);
        }

        /* ===== Content Area ===== */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-8);
        }

        .content-container {
            max-width: var(--content-max-width);
            margin: 0 auto;
        }

        /* ===== Entity Header ===== */
        .entity-header {
            margin-bottom: var(--space-8);
        }

        .entity-badges {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-caption);
            font-weight: var(--font-medium);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-layer {
            color: white;
        }

        .badge-layer.conceptual {
            background: var(--color-conceptual);
        }

        .badge-layer.logical {
            background: var(--color-logical);
            color: var(--color-bg-base);
        }

        .badge-layer.physical {
            background: var(--color-physical);
            color: var(--color-bg-base);
        }

        .badge-outline {
            background: transparent;
            border: 1px solid currentColor;
        }

        .badge-compliance {
            font-weight: var(--font-semibold);
        }

        .badge-compliance.public { color: var(--color-public); border-color: var(--color-public); }
        .badge-compliance.internal { color: var(--color-internal); border-color: var(--color-internal); }
        .badge-compliance.confidential { color: var(--color-confidential); border-color: var(--color-confidential); }
        .badge-compliance.secret { color: var(--color-secret); border-color: var(--color-secret); }
        .badge-compliance.personal-data { color: var(--color-personal-data); border-color: var(--color-personal-data); }

        .entity-title {
            font-size: var(--text-h1);
            font-weight: var(--font-semibold);
            line-height: var(--leading-h1);
            letter-spacing: -0.01em;
            margin-bottom: var(--space-2);
        }

        .entity-subtitle {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            line-height: var(--leading-body);
            max-width: var(--prose-max-width);
        }

        .entity-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-4);
            margin-top: var(--space-4);
            font-size: var(--text-small);
            color: var(--color-text-secondary);
        }

        .entity-meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        /* ===== Status Indicators ===== */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
        }

        .status-dot.active { background: var(--color-status-active); }
        .status-dot.draft {
            background: transparent;
            border: 2px solid var(--color-status-draft);
        }
        .status-dot.deprecated { background: var(--color-status-deprecated); opacity: 0.6; }
        .status-dot.planned {
            width: 8px;
            height: 8px;
            background: var(--color-status-planned);
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            border-radius: 0;
        }

        /* ===== View Tabs ===== */
        .view-tabs {
            display: flex;
            gap: 0;
            margin-bottom: var(--space-6);
            border-bottom: 1px solid var(--color-border-default);
        }

        .view-tab {
            padding: var(--space-3) var(--space-4);
            background: none;
            border: none;
            color: var(--color-text-secondary);
            font-family: var(--font-sans);
            font-size: var(--text-small);
            font-weight: var(--font-medium);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: all var(--duration-fast) var(--ease-out);
        }

        .view-tab:hover {
            color: var(--color-text-primary);
        }

        .view-tab.active {
            color: var(--color-conceptual);
            border-bottom-color: var(--color-conceptual);
        }

        /* ===== Cards/Panels ===== */
        .card {
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-4);
            overflow: hidden;
            transition: box-shadow var(--duration-fast) var(--ease-out);
        }

        .card:hover {
            box-shadow: var(--shadow-sm);
        }

        .card-accent {
            border-left: 4px solid var(--color-border-default);
        }

        .card-accent.conceptual { border-left-color: var(--color-conceptual); }
        .card-accent.logical { border-left-color: var(--color-logical); }
        .card-accent.physical { border-left-color: var(--color-physical); }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-5);
            background: var(--color-bg-elevated);
            cursor: pointer;
            transition: background-color var(--duration-fast) var(--ease-out);
        }

        .card-header:hover {
            background: var(--color-bg-hover);
        }

        .card-title {
            font-size: var(--text-small);
            font-weight: var(--font-semibold);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .card-toggle {
            color: var(--color-text-muted);
            transition: transform var(--duration-fast) var(--ease-out);
        }

        .card.collapsed .card-toggle {
            transform: rotate(-90deg);
        }

        .card-content {
            padding: var(--space-5);
            border-top: 1px solid var(--color-border-default);
        }

        .card.collapsed .card-content {
            display: none;
        }

        /* ===== Metadata Grid ===== */
        .meta-grid {
            display: grid;
            grid-template-columns: 160px 1fr;
            gap: var(--space-3) var(--space-5);
            font-size: var(--text-small);
        }

        .meta-label {
            color: var(--color-text-muted);
            font-weight: var(--font-medium);
        }

        .meta-value {
            color: var(--color-text-primary);
        }

        .meta-value a {
            color: var(--color-conceptual);
            text-decoration: none;
            transition: color var(--duration-fast) var(--ease-out);
        }

        .meta-value a:hover {
            text-decoration: underline;
        }

        /* ===== Tags ===== */
        .tag {
            display: inline-block;
            padding: var(--space-1) var(--space-2);
            background: var(--color-bg-base);
            border-radius: var(--radius-sm);
            font-size: var(--text-caption);
            color: var(--color-text-secondary);
            margin-right: var(--space-1);
            margin-bottom: var(--space-1);
        }

        .tag-mono {
            font-family: var(--font-mono);
            background: var(--color-bg-elevated);
        }

        /* ===== Mapping Cards ===== */
        .mapping-section {
            margin-bottom: var(--space-5);
        }

        .mapping-section:last-child {
            margin-bottom: 0;
        }

        .mapping-section-header {
            font-size: var(--text-caption);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
            margin-bottom: var(--space-3);
        }

        .mapping-card {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4);
            background: var(--color-bg-base);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-2);
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
            border-left: 3px solid transparent;
        }

        .mapping-card:hover {
            background: var(--color-bg-hover);
            border-color: var(--color-border-default);
        }

        .mapping-card.conceptual { border-left-color: var(--color-conceptual); }
        .mapping-card.logical { border-left-color: var(--color-logical); }
        .mapping-card.physical { border-left-color: var(--color-physical); }

        .mapping-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-semibold);
            font-size: var(--text-small);
            flex-shrink: 0;
        }

        .mapping-icon.conceptual {
            background: var(--color-conceptual-bg);
            color: var(--color-conceptual);
        }

        .mapping-icon.logical {
            background: var(--color-logical-bg);
            color: var(--color-logical);
        }

        .mapping-icon.physical {
            background: var(--color-physical-bg);
            color: var(--color-physical);
        }

        .mapping-info {
            flex: 1;
            min-width: 0;
        }

        .mapping-title {
            font-weight: var(--font-medium);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mapping-subtitle {
            font-size: var(--text-caption);
            color: var(--color-text-secondary);
        }

        .mapping-arrow {
            color: var(--color-text-muted);
            flex-shrink: 0;
        }

        /* ===== Attributes Table ===== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--text-small);
        }

        .data-table th {
            text-align: left;
            padding: var(--space-3) var(--space-4);
            background: var(--color-bg-base);
            color: var(--color-text-muted);
            font-weight: var(--font-medium);
            font-size: var(--text-caption);
            text-transform: uppercase;
            letter-spacing: 0.025em;
            border-bottom: 1px solid var(--color-border-default);
        }

        .data-table td {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border-subtle);
            vertical-align: middle;
        }

        .data-table tbody tr {
            transition: background-color var(--duration-fast) var(--ease-out);
        }

        .data-table tbody tr:hover {
            background: var(--color-bg-hover);
        }

        .data-table code {
            font-family: var(--font-mono);
            font-size: var(--text-caption);
            padding: var(--space-1) var(--space-2);
            background: var(--color-bg-base);
            border-radius: var(--radius-sm);
        }

        .key-badge {
            display: inline-block;
            padding: 2px var(--space-2);
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: var(--font-semibold);
            text-transform: uppercase;
        }

        .key-badge.pk {
            background: var(--color-logical-bg);
            color: var(--color-logical);
        }

        .key-badge.fk {
            background: var(--color-physical-bg);
            color: var(--color-physical);
        }

        .key-badge.uk {
            background: var(--color-conceptual-bg);
            color: var(--color-conceptual);
        }

        .type-label {
            font-family: var(--font-mono);
            font-size: var(--text-caption);
            color: var(--color-text-secondary);
        }

        /* ===== Empty State ===== */
        .empty-state {
            text-align: center;
            padding: var(--space-12);
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: var(--text-h3);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-2);
        }

        /* ===== Placeholder Views ===== */
        .placeholder-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            background: var(--color-bg-surface);
            border: 2px dashed var(--color-border-default);
            border-radius: var(--radius-lg);
            color: var(--color-text-secondary);
        }

        .placeholder-icon {
            font-size: 48px;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        .placeholder-title {
            font-size: var(--text-h3);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-2);
        }

        .placeholder-desc {
            color: var(--color-text-muted);
        }

        /* ===== Search Results ===== */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--color-bg-elevated);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            margin-top: var(--space-1);
            max-height: 400px;
            overflow-y: auto;
            z-index: 200;
            display: none;
            box-shadow: var(--shadow-lg);
        }

        .search-results.active {
            display: block;
        }

        .search-results-header {
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-caption);
            color: var(--color-text-muted);
            border-bottom: 1px solid var(--color-border-default);
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            cursor: pointer;
            transition: background-color var(--duration-fast) var(--ease-out);
            border-left: 3px solid transparent;
        }

        .search-result-item:hover {
            background: var(--color-bg-hover);
        }

        .search-result-item.conceptual:hover { border-left-color: var(--color-conceptual); }
        .search-result-item.logical:hover { border-left-color: var(--color-logical); }
        .search-result-item.physical:hover { border-left-color: var(--color-physical); }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-name {
            font-weight: var(--font-medium);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .search-result-meta {
            font-size: var(--text-caption);
            color: var(--color-text-muted);
        }

        /* ===== Scrollbar ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--color-bg-base);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-border-default);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-bg-hover);
        }

        /* ========================================
           Responsive Design
           ======================================== */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: var(--header-height);
                bottom: 0;
                z-index: 50;
                transform: translateX(0);
                transition: transform var(--duration-slow) var(--ease-in-out);
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
            }

            .sidebar-overlay {
                position: fixed;
                inset: 0;
                top: var(--header-height);
                background: rgba(0, 0, 0, 0.5);
                z-index: 40;
                display: none;
            }

            .sidebar-overlay.active {
                display: block;
            }

            .search-shortcut {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .layer-tabs {
                display: none;
            }

            .header {
                gap: var(--space-3);
            }

            .logo span {
                display: none;
            }

            .content-area {
                padding: var(--space-4);
            }

            .meta-grid {
                grid-template-columns: 1fr;
                gap: var(--space-2);
            }

            .meta-label {
                margin-top: var(--space-2);
            }

            .breadcrumb {
                padding: var(--space-2) var(--space-4);
            }

            .data-table {
                display: block;
                overflow-x: auto;
            }
        }

        /* ========================================
           SVG Icons (inline)
           ======================================== */
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            vertical-align: middle;
        }

        /* ========================================
           Project Overview Page
           ======================================== */
        .projects-overview {
            max-width: 1200px;
            margin: 0 auto;
        }

        .projects-header {
            margin-bottom: var(--space-8);
        }

        .projects-title {
            font-size: var(--text-display);
            font-weight: var(--font-semibold);
            line-height: var(--leading-display);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-2);
            color: var(--color-text-primary);
        }

        .projects-subtitle {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            max-width: 600px;
        }

        .projects-stats {
            display: flex;
            gap: var(--space-6);
            margin-top: var(--space-6);
            padding: var(--space-4) var(--space-5);
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-lg);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: var(--text-h1);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
        }

        .stat-label {
            font-size: var(--text-caption);
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: var(--space-5);
        }

        .project-card {
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
            position: relative;
            overflow: hidden;
        }

        .project-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--project-color, var(--color-conceptual));
        }

        .project-card:hover {
            border-color: var(--color-border-default);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .project-card-header {
            display: flex;
            align-items: flex-start;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .project-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            background: var(--project-color, var(--color-conceptual));
            color: white;
        }

        .project-info {
            flex: 1;
            min-width: 0;
        }

        .project-name {
            font-size: var(--text-h3);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-1);
        }

        .project-owner {
            font-size: var(--text-caption);
            color: var(--color-text-muted);
        }

        .project-status {
            padding: 2px var(--space-2);
            border-radius: var(--radius-full);
            font-size: 10px;
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .project-status.active {
            background: var(--color-logical-bg);
            color: var(--color-logical);
        }

        .project-status.draft {
            background: var(--color-physical-bg);
            color: var(--color-physical);
        }

        .project-status.archived {
            background: var(--color-bg-hover);
            color: var(--color-text-muted);
        }

        .project-description {
            font-size: var(--text-small);
            color: var(--color-text-secondary);
            line-height: var(--leading-body);
            margin-bottom: var(--space-4);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .project-meta {
            display: flex;
            gap: var(--space-4);
            padding-top: var(--space-4);
            border-top: 1px solid var(--color-border-subtle);
        }

        .project-meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-caption);
            color: var(--color-text-muted);
        }

        .project-meta-value {
            font-weight: var(--font-medium);
            color: var(--color-text-secondary);
        }

        .project-activity {
            margin-left: auto;
            font-size: var(--text-caption);
            color: var(--color-text-muted);
        }

        /* Project page specific breadcrumb */
        .breadcrumb-home {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast) var(--ease-out);
        }

        .breadcrumb-home:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-hover);
        }

        .breadcrumb-home svg {
            width: 14px;
            height: 14px;
        }

        .breadcrumb-item.layer-conceptual {
            color: var(--color-conceptual);
        }

        .breadcrumb-item.layer-logical {
            color: var(--color-logical);
        }

        .breadcrumb-item.layer-physical {
            color: var(--color-physical);
        }

        @media (max-width: 768px) {
            .projects-grid {
                grid-template-columns: 1fr;
            }

            .projects-stats {
                flex-wrap: wrap;
                gap: var(--space-4);
            }

            .stat-item {
                flex: 1;
                min-width: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div id="app" class="loading">
        <div class="loading-spinner"></div>
        <span>Loading Meta-Atlas...</span>
    </div>

    <script>
        // ========================================
        // SVG Icons
        // ========================================
        const icons = {
            search: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',
            chevronRight: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>',
            chevronDown: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>',
            panelLeft: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M9 3v18"/></svg>',
            sun: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>',
            moon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>',
            arrowRight: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>',
            folder: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg>',
            lightbulb: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>',
            box: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>',
            database: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>',
            server: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>',
            table: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18"/><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/></svg>',
            hash: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></svg>',
            building: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M16 10h.01"/><path d="M16 14h.01"/><path d="M8 10h.01"/><path d="M8 14h.01"/></svg>',
            map: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 6 6-3 6 3 6-3v15l-6 3-6-3-6 3z"/><path d="M9 3v15"/><path d="M15 6v15"/></svg>',
            chart: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>',
            users: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
            hammer: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91"/></svg>',
            home: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>',
            layers: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>'
        };

        // ========================================
        // Data Loading
        // ========================================
        const data = {
            projects: [],
            domains: [],
            concepts: [],
            entities: [],
            systems: [],
            schemas: [],
            tables: []
        };

        async function loadData() {
            try {
                const [projects, domains, concepts, entities, systems, schemas, tables] = await Promise.all([
                    fetch('data/projects.json').then(r => r.json()),
                    fetch('data/domains.json').then(r => r.json()),
                    fetch('data/concepts.json').then(r => r.json()),
                    fetch('data/entities.json').then(r => r.json()),
                    fetch('data/systems.json').then(r => r.json()),
                    fetch('data/schemas.json').then(r => r.json()),
                    fetch('data/tables.json').then(r => r.json())
                ]);

                data.projects = projects;
                data.domains = domains;
                data.concepts = concepts;
                data.entities = entities;
                data.systems = systems;
                data.schemas = schemas;
                data.tables = tables;

                return true;
            } catch (error) {
                console.error('Failed to load data:', error);
                return false;
            }
        }

        // ========================================
        // State Management
        // ========================================
        let state = {
            currentProject: null,
            currentLayer: 'conceptual',
            currentView: 'wiki',
            selectedItem: null,
            expandedNodes: new Set(['dom-immo', 'sys-sap', 'sch-refx']),
            expandedLayers: new Set(['conceptual', 'logical', 'physical']),
            theme: 'light',
            sidebarCollapsed: false,
            searchQuery: '',
            searchResults: []
        };

        // ========================================
        // URL Routing
        // ========================================
        function parseRoute() {
            const hash = window.location.hash.slice(1) || '/';
            const [path, queryString] = hash.split('?');
            const parts = path.split('/').filter(Boolean);
            const params = new URLSearchParams(queryString || '');

            return { parts, params };
        }

        function navigateTo(path, replace = false) {
            const method = replace ? 'replaceState' : 'pushState';
            history[method](null, '', `#${path}`);
            handleRoute();
        }

        function handleRoute() {
            const { parts, params } = parseRoute();

            if (parts.length === 0) {
                // Default route
                state.currentLayer = 'conceptual';
                state.selectedItem = null;
            } else if (parts.length === 1) {
                // Layer route: /conceptual, /logical, /physical
                if (['conceptual', 'logical', 'physical'].includes(parts[0])) {
                    state.currentLayer = parts[0];
                    state.selectedItem = null;
                }
            } else if (parts.length >= 2) {
                // Entity route: /conceptual/domain/dom-immo
                const [layer, type, id] = parts;
                if (['conceptual', 'logical', 'physical'].includes(layer)) {
                    state.currentLayer = layer;
                    if (id) {
                        const item = findItemById(id);
                        if (item) {
                            state.selectedItem = item;
                            expandParents(item);
                        }
                    }
                }
            }

            // Handle query params
            if (params.has('tab')) {
                state.currentView = params.get('tab');
            }

            renderAll();
        }

        function expandParents(item) {
            // Expand parent nodes in tree
            if (item.domain) state.expandedNodes.add(item.domain);
            if (item.system) state.expandedNodes.add(item.system);
            if (item.schema) state.expandedNodes.add(item.schema);
        }

        // ========================================
        // Utility Functions
        // ========================================
        function findItemById(id) {
            for (const project of data.projects) {
                if (project.id === id) return project;
            }
            for (const domain of data.domains) {
                if (domain.id === id) return domain;
            }
            for (const concept of data.concepts) {
                if (concept.id === id) return concept;
            }
            for (const entity of data.entities) {
                if (entity.id === id) return entity;
            }
            for (const system of data.systems) {
                if (system.id === id) return system;
            }
            for (const schema of data.schemas) {
                if (schema.id === id) return schema;
            }
            for (const table of data.tables) {
                if (table.id === id) return table;
            }
            return null;
        }

        function getConceptsForDomain(domainId) {
            return data.concepts.filter(c => c.domain === domainId);
        }

        function getSchemasForSystem(systemId) {
            return data.schemas.filter(s => s.system === systemId);
        }

        function getTablesForSchema(schemaId) {
            return data.tables.filter(t => t.schema === schemaId);
        }

        function getParentChain(item) {
            const chain = [];
            if (item.layer === 'conceptual') {
                if (item.type === 'concept') {
                    const domain = data.domains.find(d => d.id === item.domain);
                    if (domain) chain.push(domain);
                }
            } else if (item.layer === 'physical') {
                if (item.type === 'table') {
                    const schema = data.schemas.find(s => s.id === item.schema);
                    if (schema) {
                        const system = data.systems.find(sys => sys.id === schema.system);
                        if (system) chain.push(system);
                        chain.push(schema);
                    }
                } else if (item.type === 'schema') {
                    const system = data.systems.find(sys => sys.id === item.system);
                    if (system) chain.push(system);
                }
            }
            return chain;
        }

        function getTypeLabel(type) {
            const labels = {
                project: 'Project',
                domain: 'Domain',
                concept: 'Concept',
                entity: 'Logical Entity',
                system: 'System',
                schema: 'Schema',
                table: 'Table'
            };
            return labels[type] || type;
        }

        function getTypeIcon(type) {
            const iconMap = {
                project: 'P',
                domain: 'D',
                concept: 'C',
                entity: 'E',
                system: 'S',
                schema: 'Sc',
                table: 'T'
            };
            return iconMap[type] || '?';
        }

        // ========================================
        // Search with Debounce
        // ========================================
        let searchTimeout = null;

        function handleSearch(query) {
            clearTimeout(searchTimeout);
            state.searchQuery = query;

            if (!query || query.length < 2) {
                state.searchResults = [];
                renderSearchResults();
                return;
            }

            searchTimeout = setTimeout(() => {
                const q = query.toLowerCase();
                state.searchResults = getAllItems()
                    .filter(item =>
                        item.name.toLowerCase().includes(q) ||
                        item.description?.toLowerCase().includes(q) ||
                        item.nameDE?.toLowerCase().includes(q) ||
                        item.nameEn?.toLowerCase().includes(q)
                    )
                    .slice(0, 10);
                renderSearchResults();
            }, 300);
        }

        function getAllItems() {
            return [
                ...data.projects,
                ...data.domains,
                ...data.concepts,
                ...data.entities,
                ...data.systems,
                ...data.schemas,
                ...data.tables
            ];
        }

        // ========================================
        // Render Functions
        // ========================================
        function renderAll() {
            renderTree();
            renderContent();
        }

        function renderApp() {
            const app = document.getElementById('app');
            app.className = 'app-container';
            app.innerHTML = `
                <!-- Header -->
                <header class="header" role="banner">
                    <a href="#/" class="logo" onclick="goToProjectsOverview(); return false;">
                        <div class="logo-icon" aria-hidden="true"></div>
                        <span>Meta-Atlas</span>
                    </a>

                    <div class="search-container">
                        <div class="search-wrapper">
                            <span class="search-icon" aria-hidden="true">${icons.search}</span>
                            <input type="search"
                                   class="search-input"
                                   id="searchInput"
                                   placeholder="Search entities, concepts, tables..."
                                   aria-label="Search metadata catalog"
                                   autocomplete="off">
                            <span class="search-shortcut" aria-hidden="true">/</span>
                            <div class="search-results" id="searchResults" role="listbox"></div>
                        </div>
                    </div>

                    <div class="header-right">
                        <select class="lang-selector" aria-label="Language">
                            <option value="de">DE</option>
                            <option value="fr">FR</option>
                            <option value="it">IT</option>
                            <option value="en">EN</option>
                        </select>
                        <button class="icon-btn" id="themeToggle" aria-label="Toggle dark/light theme">
                            ${icons.sun}
                        </button>
                    </div>
                </header>

                <!-- Main Layout -->
                <div class="main-layout">
                    <div class="sidebar-overlay" id="sidebarOverlay"></div>

                    <!-- Sidebar -->
                    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Entity navigation">
                        <div class="sidebar-header">
                            <span class="sidebar-title">Navigation</span>
                            <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                                ${icons.panelLeft}
                            </button>
                        </div>
                        <div class="tree-container" id="treeContainer" role="tree">
                            <!-- Tree will be rendered here -->
                        </div>
                    </aside>

                    <!-- Main Content -->
                    <main class="main-content" id="main-content">
                        <nav class="breadcrumb" id="breadcrumb" aria-label="Breadcrumb">
                            <!-- Breadcrumb will be rendered here -->
                        </nav>

                        <div class="content-area" id="contentArea">
                            <div class="content-container">
                                <!-- Content will be rendered here -->
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        function renderTree() {
            const container = document.getElementById('treeContainer');
            if (!container) return;

            let html = '';

            // Conceptual Layer Section
            const isConceptualExpanded = state.expandedLayers.has('conceptual');
            html += `
                <div class="layer-section">
                    <div class="layer-section-header conceptual ${!isConceptualExpanded ? 'collapsed' : ''}" data-layer="conceptual">
                        <span class="layer-indicator"></span>
                        <span>Conceptual</span>
                        <span class="layer-toggle">${icons.chevronDown}</span>
                    </div>
                    <div class="layer-section-content ${!isConceptualExpanded ? 'collapsed' : ''}">
            `;
            for (const domain of data.domains) {
                const concepts = getConceptsForDomain(domain.id);
                html += renderTreeItem(domain, concepts);
            }
            html += `</div></div>`;

            // Logical Layer Section
            const isLogicalExpanded = state.expandedLayers.has('logical');
            html += `
                <div class="layer-section">
                    <div class="layer-section-header logical ${!isLogicalExpanded ? 'collapsed' : ''}" data-layer="logical">
                        <span class="layer-indicator"></span>
                        <span>Logical</span>
                        <span class="layer-toggle">${icons.chevronDown}</span>
                    </div>
                    <div class="layer-section-content ${!isLogicalExpanded ? 'collapsed' : ''}">
            `;
            for (const entity of data.entities) {
                html += renderTreeLeaf(entity);
            }
            html += `</div></div>`;

            // Physical Layer Section
            const isPhysicalExpanded = state.expandedLayers.has('physical');
            html += `
                <div class="layer-section">
                    <div class="layer-section-header physical ${!isPhysicalExpanded ? 'collapsed' : ''}" data-layer="physical">
                        <span class="layer-indicator"></span>
                        <span>Physical</span>
                        <span class="layer-toggle">${icons.chevronDown}</span>
                    </div>
                    <div class="layer-section-content ${!isPhysicalExpanded ? 'collapsed' : ''}">
            `;
            for (const system of data.systems) {
                const schemas = getSchemasForSystem(system.id);
                html += renderTreeItemNested(system, schemas);
            }
            html += `</div></div>`;

            container.innerHTML = html;
            attachTreeListeners();
            attachLayerToggleListeners();
        }

        function attachLayerToggleListeners() {
            document.querySelectorAll('.layer-section-header').forEach(header => {
                header.addEventListener('click', () => {
                    const layer = header.dataset.layer;
                    if (state.expandedLayers.has(layer)) {
                        state.expandedLayers.delete(layer);
                    } else {
                        state.expandedLayers.add(layer);
                    }
                    renderTree();
                });
            });
        }

        function renderTreeItem(item, children) {
            const isExpanded = state.expandedNodes.has(item.id);
            const isSelected = state.selectedItem?.id === item.id;
            const hasChildren = children && children.length > 0;

            let childrenHtml = '';
            if (hasChildren) {
                for (const child of children) {
                    childrenHtml += renderTreeLeaf(child);
                }
            }

            return `
                <div class="tree-item" data-id="${item.id}">
                    <div class="tree-node ${isSelected ? 'selected ' + item.layer : ''}"
                         data-id="${item.id}"
                         role="treeitem"
                         aria-expanded="${isExpanded}"
                         aria-selected="${isSelected}">
                        <span class="tree-toggle ${isExpanded ? 'expanded' : ''}" aria-hidden="true">
                            ${hasChildren ? icons.chevronRight : ''}
                        </span>
                        <span class="tree-icon ${item.layer}">${getTypeIcon(item.type)}</span>
                        <span class="tree-label">${item.name}</span>
                        ${hasChildren ? `<span class="tree-count">${children.length}</span>` : ''}
                    </div>
                    <div class="tree-children ${isExpanded ? 'expanded' : ''}" role="group" data-parent="${item.id}">
                        ${childrenHtml}
                    </div>
                </div>
            `;
        }

        function renderTreeItemNested(system, schemas) {
            const isExpanded = state.expandedNodes.has(system.id);
            const isSelected = state.selectedItem?.id === system.id;
            const hasChildren = schemas && schemas.length > 0;

            let schemasHtml = '';
            for (const schema of schemas) {
                const tables = getTablesForSchema(schema.id);
                schemasHtml += renderTreeItem(schema, tables);
            }

            return `
                <div class="tree-item" data-id="${system.id}">
                    <div class="tree-node ${isSelected ? 'selected ' + system.layer : ''}"
                         data-id="${system.id}"
                         role="treeitem"
                         aria-expanded="${isExpanded}"
                         aria-selected="${isSelected}">
                        <span class="tree-toggle ${isExpanded ? 'expanded' : ''}" aria-hidden="true">
                            ${hasChildren ? icons.chevronRight : ''}
                        </span>
                        <span class="tree-icon ${system.layer}">${getTypeIcon(system.type)}</span>
                        <span class="tree-label">${system.name}</span>
                        ${hasChildren ? `<span class="tree-count">${schemas.length}</span>` : ''}
                    </div>
                    <div class="tree-children ${isExpanded ? 'expanded' : ''}" role="group" data-parent="${system.id}">
                        ${schemasHtml}
                    </div>
                </div>
            `;
        }

        function renderTreeLeaf(item) {
            const isSelected = state.selectedItem?.id === item.id;
            return `
                <div class="tree-item" data-id="${item.id}">
                    <div class="tree-node ${isSelected ? 'selected ' + item.layer : ''}"
                         data-id="${item.id}"
                         role="treeitem"
                         aria-selected="${isSelected}">
                        <span class="tree-toggle" aria-hidden="true"></span>
                        <span class="tree-icon ${item.layer}">${getTypeIcon(item.type)}</span>
                        <span class="tree-label">${item.name}</span>
                    </div>
                </div>
            `;
        }

        function renderBreadcrumb(item) {
            const breadcrumb = document.getElementById('breadcrumb');
            if (!breadcrumb) return;

            let html = '';

            // Always show "All projects" as the first breadcrumb item
            html += `<span class="breadcrumb-home" data-action="home" tabindex="0">${icons.home} All projects</span>`;

            if (!item) {
                breadcrumb.innerHTML = html;
                attachBreadcrumbListeners(breadcrumb);
                return;
            }

            // Add separator after "All projects"
            html += `<span class="breadcrumb-separator" aria-hidden="true">/</span>`;

            // If we have a current project and the item is not the project itself, show the project
            if (state.currentProject && item.type !== 'project') {
                html += `<span class="breadcrumb-item" data-id="${state.currentProject.id}" tabindex="0">${state.currentProject.name}</span>`;
                html += `<span class="breadcrumb-separator" aria-hidden="true">/</span>`;
            }

            // If item is a project, just show it as current
            if (item.type === 'project') {
                html += `<span class="breadcrumb-current" aria-current="page">${item.name}</span>`;
                breadcrumb.innerHTML = html;
                attachBreadcrumbListeners(breadcrumb);
                return;
            }

            // Add layer indicator
            if (item.layer) {
                html += `<span class="breadcrumb-item layer-${item.layer}" data-layer="${item.layer}" tabindex="0">${item.layer.charAt(0).toUpperCase() + item.layer.slice(1)}</span>`;
                html += `<span class="breadcrumb-separator" aria-hidden="true">/</span>`;
            }

            // Add parent chain
            const chain = getParentChain(item);
            html += chain.map(parent =>
                `<span class="breadcrumb-item" data-id="${parent.id}" tabindex="0">${parent.name}</span>
                 <span class="breadcrumb-separator" aria-hidden="true">/</span>`
            ).join('');

            html += `<span class="breadcrumb-current" aria-current="page">${item.name}</span>`;
            breadcrumb.innerHTML = html;
            attachBreadcrumbListeners(breadcrumb);
        }

        function attachBreadcrumbListeners(breadcrumb) {
            // Home button listener
            breadcrumb.querySelectorAll('.breadcrumb-home').forEach(el => {
                el.addEventListener('click', () => goToProjectsOverview());
                el.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        goToProjectsOverview();
                    }
                });
            });

            // Item listeners
            breadcrumb.querySelectorAll('.breadcrumb-item').forEach(el => {
                el.addEventListener('click', () => {
                    if (el.dataset.id) {
                        selectItem(el.dataset.id);
                    } else if (el.dataset.layer) {
                        state.currentLayer = el.dataset.layer;
                        renderAll();
                    }
                });
                el.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        if (el.dataset.id) {
                            selectItem(el.dataset.id);
                        }
                    }
                });
            });
        }

        function goToProjectsOverview() {
            state.currentProject = null;
            state.selectedItem = null;
            navigateTo('/');
        }

        function renderProjectsOverview() {
            const contentArea = document.getElementById('contentArea');
            if (!contentArea) return;

            const totalEntities = data.entities.length;
            const totalTables = data.tables.length;
            const totalConcepts = data.concepts.length;
            const totalProjects = data.projects.length;

            const container = contentArea.querySelector('.content-container');
            container.innerHTML = `
                <div class="projects-overview">
                    <div class="projects-header">
                        <h1 class="projects-title">All Projects</h1>
                        <p class="projects-subtitle">Explore metadata catalogs across your organization. Each project contains domains, entities, and physical implementations.</p>
                        <div class="projects-stats">
                            <div class="stat-item">
                                <div class="stat-value">${totalProjects}</div>
                                <div class="stat-label">Projects</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${totalConcepts}</div>
                                <div class="stat-label">Concepts</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${totalEntities}</div>
                                <div class="stat-label">Entities</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${totalTables}</div>
                                <div class="stat-label">Tables</div>
                            </div>
                        </div>
                    </div>
                    <div class="projects-grid">
                        ${data.projects.map(project => renderProjectCard(project)).join('')}
                    </div>
                </div>
            `;

            // Attach project card listeners
            container.querySelectorAll('.project-card').forEach(card => {
                card.addEventListener('click', () => {
                    const projectId = card.dataset.id;
                    selectProject(projectId);
                });
            });
        }

        function renderProjectCard(project) {
            const iconName = project.icon || 'folder';
            const icon = icons[iconName] || icons.folder;

            return `
                <div class="project-card" data-id="${project.id}" style="--project-color: ${project.color || '#3B82F6'}">
                    <div class="project-card-header">
                        <div class="project-icon" style="background: ${project.color || '#3B82F6'}">
                            ${icon}
                        </div>
                        <div class="project-info">
                            <div class="project-name">${project.name}</div>
                            <div class="project-owner">${project.owner}</div>
                        </div>
                        <span class="project-status ${project.status}">${project.status}</span>
                    </div>
                    <p class="project-description">${project.description}</p>
                    <div class="project-meta">
                        <div class="project-meta-item">
                            ${icons.box}
                            <span class="project-meta-value">${project.entities || 0}</span> Entities
                        </div>
                        <div class="project-meta-item">
                            ${icons.table}
                            <span class="project-meta-value">${project.tables || 0}</span> Tables
                        </div>
                        <div class="project-activity">
                            Last active: ${project.lastActivity || project.updated || project.created}
                        </div>
                    </div>
                </div>
            `;
        }

        function selectProject(projectId) {
            const project = data.projects.find(p => p.id === projectId);
            if (project) {
                state.currentProject = project;
                state.selectedItem = project;
                navigateTo(`/project/${project.id}`);
            }
        }

        function renderContent() {
            const contentArea = document.getElementById('contentArea');
            if (!contentArea) return;

            const item = state.selectedItem;

            // Show projects overview when no item selected
            if (!item && !state.currentProject) {
                renderBreadcrumb(null);
                renderProjectsOverview();
                return;
            }

            // If we have a project selected but no specific item, show the project detail
            if (!item && state.currentProject) {
                state.selectedItem = state.currentProject;
            }

            if (!state.selectedItem) {
                renderBreadcrumb(null);
                contentArea.querySelector('.content-container').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon" aria-hidden="true">${icons.database}</div>
                        <h2 class="empty-state-title">Select an entity</h2>
                        <p>Choose an item from the navigation to view its details</p>
                    </div>
                `;
                return;
            }

            renderBreadcrumb(item);

            const container = contentArea.querySelector('.content-container');
            container.innerHTML = `
                <div class="entity-header">
                    <div class="entity-badges">
                        <span class="badge badge-layer ${item.layer}">${getTypeLabel(item.type)}</span>
                        ${item.status === 'active' ? '' : `<span class="badge badge-outline">${item.status}</span>`}
                    </div>
                    <h1 class="entity-title">${item.name}</h1>
                    <p class="entity-subtitle">${item.description || ''}</p>
                    <div class="entity-meta">
                        <span class="entity-meta-item">
                            <span class="status-indicator">
                                <span class="status-dot ${item.status}" aria-hidden="true"></span>
                                ${item.status?.charAt(0).toUpperCase() + item.status?.slice(1) || 'Unknown'}
                            </span>
                        </span>
                        ${item.created ? `<span class="entity-meta-item">Created: ${item.created}</span>` : ''}
                        ${item.owner ? `<span class="entity-meta-item">Owner: ${item.owner}</span>` : ''}
                    </div>
                </div>

                <div class="view-tabs" role="tablist">
                    <button class="view-tab ${state.currentView === 'wiki' ? 'active' : ''}" data-view="wiki" role="tab" aria-selected="${state.currentView === 'wiki'}">Details</button>
                    <button class="view-tab ${state.currentView === 'diagram' ? 'active' : ''}" data-view="diagram" role="tab" aria-selected="${state.currentView === 'diagram'}">Diagram</button>
                    <button class="view-tab ${state.currentView === 'lineage' ? 'active' : ''}" data-view="lineage" role="tab" aria-selected="${state.currentView === 'lineage'}">Lineage</button>
                    <button class="view-tab ${state.currentView === 'history' ? 'active' : ''}" data-view="history" role="tab" aria-selected="${state.currentView === 'history'}">History</button>
                </div>

                <div class="view-content" role="tabpanel">
                    ${state.currentView === 'wiki' ? renderWikiView(item) : renderPlaceholderView(state.currentView)}
                </div>
            `;

            attachContentListeners();
        }

        function renderWikiView(item) {
            let html = '';

            // Basic Information Card
            html += `
                <div class="card card-accent ${item.layer}">
                    <div class="card-header" data-card="basic" aria-expanded="true">
                        <span class="card-title">Basic Information</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        <div class="meta-grid">
                            <span class="meta-label">Name (DE)</span>
                            <span class="meta-value">${item.nameDE || item.name}</span>
                            ${item.nameEn ? `
                                <span class="meta-label">Name (EN)</span>
                                <span class="meta-value">${item.nameEn}</span>
                            ` : ''}
                            ${item.nameFr ? `
                                <span class="meta-label">Name (FR)</span>
                                <span class="meta-value">${item.nameFr}</span>
                            ` : ''}
                            <span class="meta-label">Description</span>
                            <span class="meta-value">${item.description || ''}</span>
                            ${item.synonyms ? `
                                <span class="meta-label">Synonyms</span>
                                <span class="meta-value">${item.synonyms.map(s => `<span class="tag">${s}</span>`).join('')}</span>
                            ` : ''}
                            ${item.owner ? `
                                <span class="meta-label">Owner</span>
                                <span class="meta-value">${item.owner}</span>
                            ` : ''}
                            ${item.technology ? `
                                <span class="meta-label">Technology</span>
                                <span class="meta-value"><span class="tag tag-mono">${item.technology}</span></span>
                            ` : ''}
                            ${item.rowCount ? `
                                <span class="meta-label">Row Count</span>
                                <span class="meta-value">${item.rowCount.toLocaleString()}</span>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;

            // Compliance Panel (for concepts and entities)
            if (item.type === 'concept' || item.type === 'entity') {
                html += `
                    <div class="card">
                        <div class="card-header" data-card="compliance" aria-expanded="true">
                            <span class="card-title">Compliance & Legal</span>
                            <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                        </div>
                        <div class="card-content">
                            <div class="meta-grid">
                                ${item.legalRefs && item.legalRefs.length ? `
                                    <span class="meta-label">Legal References</span>
                                    <span class="meta-value">${item.legalRefs.map(r => `<span class="tag">${r}</span>`).join('')}</span>
                                ` : ''}
                                ${item.standards && item.standards.length ? `
                                    <span class="meta-label">Standards</span>
                                    <span class="meta-value">${item.standards.map(s => `<span class="tag tag-mono">${s}</span>`).join('')}</span>
                                ` : ''}
                                <span class="meta-label">Classification</span>
                                <span class="meta-value">
                                    <span class="badge badge-outline badge-compliance internal">Internal</span>
                                </span>
                                <span class="meta-label">Personal Data</span>
                                <span class="meta-value">No</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Attributes Panel (for entities and tables)
            if (item.attributes || item.columns) {
                const attrs = item.attributes || item.columns;
                html += `
                    <div class="card">
                        <div class="card-header" data-card="attributes" aria-expanded="true">
                            <span class="card-title">${item.attributes ? 'Attributes' : 'Columns'} (${attrs.length})</span>
                            <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                        </div>
                        <div class="card-content" style="padding: 0;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Nullable</th>
                                        <th>Key</th>
                                        ${item.columns ? '<th>Maps To</th>' : ''}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${attrs.map(attr => `
                                        <tr>
                                            <td><code>${attr.name}</code></td>
                                            <td><span class="type-label">${attr.type}</span></td>
                                            <td>${attr.nullable ? 'Yes' : 'No'}</td>
                                            <td>${attr.key ? `<span class="key-badge ${attr.key.toLowerCase()}">${attr.key}</span>` : ''}</td>
                                            ${item.columns ? `<td>${attr.mappedTo ? `<code>${attr.mappedTo}</code>` : ''}</td>` : ''}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // Cross-Layer Mappings
            html += renderMappingsPanel(item);

            return html;
        }

        function renderMappingsPanel(item) {
            const mappings = { conceptual: [], logical: [], physical: [] };

            if (item.type === 'concept') {
                const entities = data.entities.filter(e => e.concept === item.id);
                mappings.logical = entities;
                entities.forEach(e => {
                    e.physicalTables?.forEach(tId => {
                        const table = findItemById(tId);
                        if (table) mappings.physical.push(table);
                    });
                });
            } else if (item.type === 'entity') {
                if (item.concept) {
                    const concept = findItemById(item.concept);
                    if (concept) mappings.conceptual.push(concept);
                }
                item.physicalTables?.forEach(tId => {
                    const table = findItemById(tId);
                    if (table) mappings.physical.push(table);
                });
            } else if (item.type === 'table') {
                if (item.logicalEntity) {
                    const entity = findItemById(item.logicalEntity);
                    if (entity) {
                        mappings.logical.push(entity);
                        if (entity.concept) {
                            const concept = findItemById(entity.concept);
                            if (concept) mappings.conceptual.push(concept);
                        }
                    }
                }
            }

            const hasMappings = mappings.conceptual.length || mappings.logical.length || mappings.physical.length;
            if (!hasMappings) return '';

            return `
                <div class="card">
                    <div class="card-header" data-card="mappings" aria-expanded="true">
                        <span class="card-title">Cross-Layer Mappings</span>
                        <span class="card-toggle" aria-hidden="true">${icons.chevronDown}</span>
                    </div>
                    <div class="card-content">
                        ${mappings.conceptual.length ? `
                            <div class="mapping-section">
                                <div class="mapping-section-header">Conceptual Layer</div>
                                ${mappings.conceptual.map(m => renderMappingCard(m)).join('')}
                            </div>
                        ` : ''}
                        ${mappings.logical.length ? `
                            <div class="mapping-section">
                                <div class="mapping-section-header">Logical Layer</div>
                                ${mappings.logical.map(m => renderMappingCard(m)).join('')}
                            </div>
                        ` : ''}
                        ${mappings.physical.length ? `
                            <div class="mapping-section">
                                <div class="mapping-section-header">Physical Layer</div>
                                ${mappings.physical.map(m => renderMappingCard(m)).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderMappingCard(item) {
            return `
                <div class="mapping-card ${item.layer}" data-id="${item.id}" tabindex="0" role="button">
                    <div class="mapping-icon ${item.layer}">${getTypeIcon(item.type)}</div>
                    <div class="mapping-info">
                        <div class="mapping-title">${item.name}</div>
                        <div class="mapping-subtitle">${getTypeLabel(item.type)}</div>
                    </div>
                    <span class="mapping-arrow" aria-hidden="true">${icons.arrowRight}</span>
                </div>
            `;
        }

        function renderPlaceholderView(view) {
            const viewInfo = {
                diagram: { icon: icons.box, title: 'Entity Diagram', desc: 'Visual entity-relationship diagram' },
                lineage: { icon: icons.arrowRight, title: 'Data Lineage', desc: 'Source to target data flow' },
                history: { icon: icons.hash, title: 'Version History', desc: 'Changelog and versioning' }
            };
            const info = viewInfo[view] || { icon: '?', title: view, desc: '' };
            return `
                <div class="placeholder-view">
                    <div class="placeholder-icon" aria-hidden="true">${info.icon}</div>
                    <h3 class="placeholder-title">${info.title}</h3>
                    <p class="placeholder-desc">${info.desc}</p>
                    <p style="margin-top: var(--space-4); opacity: 0.5; font-size: var(--text-caption);">Coming soon in future release</p>
                </div>
            `;
        }

        function renderSearchResults() {
            const container = document.getElementById('searchResults');
            if (!container) return;

            if (!state.searchResults.length) {
                container.classList.remove('active');
                return;
            }

            container.innerHTML = `
                <div class="search-results-header">${state.searchResults.length} results</div>
                ${state.searchResults.map(item => `
                    <div class="search-result-item ${item.layer}" data-id="${item.id}" role="option" tabindex="0">
                        <span class="tree-icon ${item.layer}">${getTypeIcon(item.type)}</span>
                        <div class="search-result-info">
                            <div class="search-result-name">${item.name}</div>
                            <div class="search-result-meta">${getTypeLabel(item.type)}  ${item.layer}</div>
                        </div>
                    </div>
                `).join('')}
            `;

            container.classList.add('active');

            container.querySelectorAll('.search-result-item').forEach(el => {
                el.addEventListener('click', () => {
                    selectItem(el.dataset.id);
                    document.getElementById('searchInput').value = '';
                    state.searchResults = [];
                    container.classList.remove('active');
                });
            });
        }

        // ========================================
        // Event Handlers
        // ========================================
        function selectItem(id) {
            const item = findItemById(id);
            if (item) {
                state.selectedItem = item;
                state.currentView = 'wiki';
                if (item.layer !== state.currentLayer) {
                    state.currentLayer = item.layer;
                }
                expandParents(item);
                navigateTo(`/${item.layer}/${item.type}/${item.id}`);
            }
        }

        function toggleNode(id) {
            if (state.expandedNodes.has(id)) {
                state.expandedNodes.delete(id);
            } else {
                state.expandedNodes.add(id);
            }
            renderTree();
        }

        function updateLayerTabs() {
            document.querySelectorAll('.layer-tab').forEach(tab => {
                const isActive = tab.dataset.layer === state.currentLayer;
                tab.classList.toggle('active', isActive);
                tab.setAttribute('aria-selected', isActive);
            });
        }

        function attachTreeListeners() {
            document.querySelectorAll('.tree-node').forEach(node => {
                node.addEventListener('click', (e) => {
                    const id = node.dataset.id;
                    if (e.target.closest('.tree-toggle')) {
                        toggleNode(id);
                    } else {
                        selectItem(id);
                    }
                });

                node.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectItem(node.dataset.id);
                    } else if (e.key === 'ArrowRight') {
                        state.expandedNodes.add(node.dataset.id);
                        renderTree();
                    } else if (e.key === 'ArrowLeft') {
                        state.expandedNodes.delete(node.dataset.id);
                        renderTree();
                    }
                });
            });
        }

        function attachContentListeners() {
            // View tabs
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    state.currentView = tab.dataset.view;
                    renderContent();
                });
            });

            // Card toggles
            document.querySelectorAll('.card-header').forEach(header => {
                header.addEventListener('click', () => {
                    const card = header.closest('.card');
                    card.classList.toggle('collapsed');
                    header.setAttribute('aria-expanded', !card.classList.contains('collapsed'));
                });
            });

            // Mapping cards
            document.querySelectorAll('.mapping-card').forEach(card => {
                card.addEventListener('click', () => selectItem(card.dataset.id));
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectItem(card.dataset.id);
                    }
                });
            });
        }

        // ========================================
        // Keyboard Shortcuts
        // ========================================
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // "/" to focus search
                if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
                    const searchInput = document.getElementById('searchInput');
                    if (document.activeElement !== searchInput) {
                        e.preventDefault();
                        searchInput?.focus();
                    }
                }

                // "[" to collapse sidebar
                if (e.key === '[' && !e.ctrlKey && !e.metaKey) {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar && !state.sidebarCollapsed) {
                        state.sidebarCollapsed = true;
                        sidebar.classList.add('collapsed');
                    }
                }

                // "]" to expand sidebar
                if (e.key === ']' && !e.ctrlKey && !e.metaKey) {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar && state.sidebarCollapsed) {
                        state.sidebarCollapsed = false;
                        sidebar.classList.remove('collapsed');
                    }
                }

                // Escape to close search
                if (e.key === 'Escape') {
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults?.classList.contains('active')) {
                        searchResults.classList.remove('active');
                        document.getElementById('searchInput').blur();
                    }
                }
            });
        }

        // ========================================
        // Initialization
        // ========================================
        async function init() {
            const loaded = await loadData();

            if (!loaded) {
                document.getElementById('app').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">${icons.database}</div>
                        <h2 class="empty-state-title">Failed to load data</h2>
                        <p>Please check if data files exist in /data folder.</p>
                    </div>
                `;
                return;
            }

            renderApp();
            setupKeyboardShortcuts();

            // Layer tabs
            document.querySelectorAll('.layer-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    state.currentLayer = tab.dataset.layer;
                    state.selectedItem = null;
                    state.currentView = 'wiki';
                    navigateTo(`/${state.currentLayer}`);
                });
            });

            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', () => {
                state.theme = state.theme === 'light' ? 'dark' : 'light';
                document.documentElement.dataset.theme = state.theme;
                document.getElementById('themeToggle').innerHTML = state.theme === 'light' ? icons.sun : icons.moon;
            });

            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', () => {
                state.sidebarCollapsed = !state.sidebarCollapsed;
                document.getElementById('sidebar').classList.toggle('collapsed', state.sidebarCollapsed);
            });

            // Sidebar overlay (mobile)
            document.getElementById('sidebarOverlay')?.addEventListener('click', () => {
                state.sidebarCollapsed = true;
                document.getElementById('sidebar').classList.add('collapsed');
            });

            // Search
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => handleSearch(e.target.value));
            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    document.getElementById('searchResults')?.classList.remove('active');
                }, 200);
            });

            // Handle URL routing
            window.addEventListener('hashchange', handleRoute);
            handleRoute();

            // If no specific route, show projects overview (landing page)
            if (!state.selectedItem && !state.currentProject) {
                renderProjectsOverview();
            }
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
